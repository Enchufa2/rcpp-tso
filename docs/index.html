<html>
<head>
  <title>Rcpp Top StackOverflow Q&A</title>
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <main>
  <header>
    <h1>Rcpp Top StackOverflow Q&A</h1>
    <h2>Top users by number of answers</h2>
    <ul class="cloud"><li><a data-weight='1' href='https://stackoverflow.com/users/16474343/daniela'>Daniela</a></li>
<li><a data-weight='1' href='https://stackoverflow.com/users/168747/marek'>Marek</a></li>
<li><a data-weight='1' href='https://stackoverflow.com/users/980833/josh-obrien'>Josh O&#39;Brien</a></li>
<li><a data-weight='1' href='https://stackoverflow.com/users/1922182/politicaleconomist'>politicalEconomist</a></li>
<li><a data-weight='16' href='https://stackoverflow.com/users/143305/dirk-eddelbuettel'>Dirk Eddelbuettel</a></li>
<li><a data-weight='1' href='https://stackoverflow.com/users/636656/ari-b-friedman'>Ari B. Friedman</a></li>
<li><a data-weight='6' href='https://stackoverflow.com/users/1342082/kevin-ushey'>Kevin Ushey</a></li>
<li><a data-weight='9' href='https://stackoverflow.com/users/1345455/coatless'>coatless</a></li>
<li><a data-weight='1' href='https://stackoverflow.com/users/1922377/jjallaire'>jjallaire</a></li>
<li><a data-weight='1' href='https://stackoverflow.com/users/8416610/ralf-stubner'>Ralf Stubner</a></li>
<li><a data-weight='1' href='https://stackoverflow.com/users/2542702/z-boson'>Z boson</a></li>
<li><a data-weight='3' href='https://stackoverflow.com/users/3204250/cdeterman'>cdeterman</a></li>
<li><a data-weight='1' href='https://stackoverflow.com/users/3048453/david'>David</a></li>
<li><a data-weight='5' href='https://stackoverflow.com/users/499163/romain-francois'>Romain Francois</a></li>
<li><a data-weight='1' href='https://stackoverflow.com/users/2414948/alexis-laz'>alexis_laz</a></li>
<li><a data-weight='1' href='https://stackoverflow.com/users/316644/digemall'>digEmAll</a></li>
<li><a data-weight='1' href='https://stackoverflow.com/users/378229/allan-engelhardt'>Allan Engelhardt</a></li>
<li><a data-weight='1' href='https://stackoverflow.com/users/1900149/tonytonov'>tonytonov</a></li>
<li><a data-weight='1' href='https://stackoverflow.com/users/3573401/khashaa'>Khashaa</a></li>
<li><a data-weight='2' href='https://stackoverflow.com/users/1869097/nrussell'>nrussell</a></li>
<li><a data-weight='1' href='https://stackoverflow.com/users/489704/jbaums'>jbaums</a></li>
<li><a data-weight='1' href='https://stackoverflow.com/users/817778/eddi'>eddi</a></li>
<li><a data-weight='1' href='https://stackoverflow.com/users/65863/remy-lebeau'>Remy Lebeau</a></li>
<li><a data-weight='1' href='https://stackoverflow.com/users/324364/joran'>joran</a></li>
<li><a data-weight='1' href='https://stackoverflow.com/users/559784/arun'>Arun</a></li>
<li><a data-weight='1' href='https://stackoverflow.com/users/4770166/rhertel'>RHertel</a></li>
<li><a data-weight='1' href='https://stackoverflow.com/users/1315472/florian'>Florian</a></li>
<li><a data-weight='1' href='https://stackoverflow.com/users/1968/konrad-rudolph'>Konrad Rudolph</a></li>
<li><a data-weight='1' href='https://stackoverflow.com/users/173985/thell'>Thell</a></li>
<li><a data-weight='1' href='https://stackoverflow.com/users/1191259/frank'>Frank</a></li></ul>
  </header>
  <nav><ul><li><a href='#qa-2908822'>Speed up the loop operation in R</a></li>
<li><a href='#qa-68416435'>Rcpp package doesn&#39;t include Rcpp_precious_remove</a></li>
<li><a href='#qa-11300048'>Rcpp pass by reference vs. by value</a></li>
<li><a href='#qa-11275187'>Replace negative values by zero</a></li>
<li><a href='#qa-6074310'>Using Rcpp within parallel code via snow to make a cluster</a></li>
<li><a href='#qa-43597632'>Understanding the contents of the Makevars file in R (macros, variables, ~/.R/Makevars and pkg/src/Makevars)</a></li>
<li><a href='#qa-48069990'>Multithreaded &amp; SIMD vectorized Mandelbrot in R using Rcpp &amp; OpenMP</a></li>
<li><a href='#qa-5233769'>Practical limits of R data frame</a></li>
<li><a href='#qa-26241085'>Rcpp function check if missing value</a></li>
<li><a href='#qa-20474303'>using C function from other package in Rcpp</a></li>
<li><a href='#qa-36594628'>Call a function from c++ via environment Rcpp</a></li>
<li><a href='#qa-38016851'>Call R functions in Rcpp</a></li>
<li><a href='#qa-19823915'>how can I handle vectors without knowing the type in Rcpp</a></li>
<li><a href='#qa-22828361'>Rcpp function to select (and to return) a sub-dataframe</a></li>
<li><a href='#qa-21225662'>calling a user-defined R function from C++ using Rcpp</a></li>
<li><a href='#qa-51110244'>In Rcpp, how to get a user-defined structure from C into R</a></li>
<li><a href='#qa-43221681'>Changing R&#39;s Seed from Rcpp to Guarantee Reproducibility</a></li>
<li><a href='#qa-18570526'>How to build a R package which use Rcpp with external c++ libraries?</a></li>
<li><a href='#qa-46039132'>Renaming and Hiding an Exported Rcpp function in an R Package</a></li>
<li><a href='#qa-9949202'>1-dimensional Matrix is changed to a vector in R</a></li>
<li><a href='#qa-45549992'>Group vector on conditional sum</a></li>
<li><a href='#qa-46473895'>Calling R&#39;s optim function from within C++ using Rcpp</a></li>
<li><a href='#qa-27371543'>how many vectors can be added in DataFrame::create( vec1, vec2 ... )?</a></li>
<li><a href='#qa-38518387'>Using Rcpp functions inside of R&#39;s par*apply functions from the parallel package</a></li>
<li><a href='#qa-3088650'>How do I create a list of vectors in Rcpp?</a></li>
<li><a href='#qa-41602024'>Should I prefer Rcpp::NumericVector over std::vector?</a></li>
<li><a href='#qa-48363076'>Declare a variable as a reference in Rcpp</a></li>
<li><a href='#qa-37060211'>efficiently locf by groups in a single R data.table</a></li>
<li><a href='#qa-30628333'>Building a tiny R package with CUDA and Rcpp</a></li>
<li><a href='#qa-19686892'>passing unevaluated expressions to C/C++</a></li></ul></nav>
  <section><article class="qa" id="qa-2908822">

  <div class="question">

    <div class="stats">
      <div class="votes">
        <span class="score">200</span>
        <div class="viewcount">votes</div>
      </div>
      <div class="views">
        <span class="score">98k</span>
        <div class="viewcount">views</div>
      </div>
    </div>

    <div class="content">
      <div class="title">
        <h3>Speed up the loop operation in R</h3>
        <a href="https://stackoverflow.com/questions/2908822/speed-up-the-loop-operation-in-r" target="_blank">[see original]</a>
      </div>
      <div class="tags"><span>performance</span><span>r</span><span>loops</span><span>rcpp</span><span>r-faq</span></div>
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/350373/kay" target="_blank"><img src="https://www.gravatar.com/avatar/289dff1a60304e7d41bb3dc8e7a2d1c0?s=256&d=identicon&r=PG" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/350373/kay" target="_blank">Kay</a>
        asked May 25 '10 at 21:55
      </div>
      <div class="body">
        <details>
          <summary>Click to expand question</summary>
          <p>I have a big performance problem in R. I wrote a function that iterates over a <code>data.frame</code> object. It simply adds a new column to a <code>data.frame</code> and accumulates something. (simple operation). The <code>data.frame</code> has roughly 850K rows. My PC is still working (about 10h now) and I have no idea about the runtime.</p>

<pre><code>dayloop2 &lt;- function(temp){
    for (i in 1:nrow(temp)){    
        temp[i,10] &lt;- i
        if (i &gt; 1) {             
            if ((temp[i,6] == temp[i-1,6]) &amp; (temp[i,3] == temp[i-1,3])) { 
                temp[i,10] &lt;- temp[i,9] + temp[i-1,10]                    
            } else {
                temp[i,10] &lt;- temp[i,9]                                    
            }
        } else {
            temp[i,10] &lt;- temp[i,9]
        }
    }
    names(temp)[names(temp) == "V10"] &lt;- "Kumm."
    return(temp)
}
</code></pre>

<p>Any ideas how to speed up this operation?</p>

        </details>
      </div>
    </div>

  </div>

  <div class="answer">

    <div class="stats">
      <div class="votes answer-accepted-FALSE">
        <span class="score">447</span>
        <div class="viewcount">votes</div>
      </div>
    </div>

    <div class="content">
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/168747/marek" target="_blank"><img src="https://www.gravatar.com/avatar/b03df38616f732d566331162aa7f3c5a?s=256&d=identicon&r=PG" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/168747/marek" target="_blank">Marek</a>
        replied Jun 03 '10 at 22:34
      </div>
      <div class="body">
        <details>
          <summary>Click to expand answer</summary>
          <p>I have a big performance problem in R. I wrote a function that iterates over a <code>data.frame</code> object. It simply adds a new column to a <code>data.frame</code> and accumulates something. (simple operation). The <code>data.frame</code> has roughly 850K rows. My PC is still working (about 10h now) and I have no idea about the runtime.</p>

<pre><code>dayloop2 &lt;- function(temp){
    for (i in 1:nrow(temp)){    
        temp[i,10] &lt;- i
        if (i &gt; 1) {             
            if ((temp[i,6] == temp[i-1,6]) &amp; (temp[i,3] == temp[i-1,3])) { 
                temp[i,10] &lt;- temp[i,9] + temp[i-1,10]                    
            } else {
                temp[i,10] &lt;- temp[i,9]                                    
            }
        } else {
            temp[i,10] &lt;- temp[i,9]
        }
    }
    names(temp)[names(temp) == "V10"] &lt;- "Kumm."
    return(temp)
}
</code></pre>

<p>Any ideas how to speed up this operation?</p>

        </details>
      </div>
    </div>

  </div>

</article> <article class="qa" id="qa-68416435">

  <div class="question">

    <div class="stats">
      <div class="votes">
        <span class="score">43</span>
        <div class="viewcount">votes</div>
      </div>
      <div class="views">
        <span class="score">51.8k</span>
        <div class="viewcount">views</div>
      </div>
    </div>

    <div class="content">
      <div class="title">
        <h3>Rcpp package doesn&#39;t include Rcpp_precious_remove</h3>
        <a href="https://stackoverflow.com/questions/68416435/rcpp-package-doesnt-include-rcpp-precious-remove" target="_blank">[see original]</a>
      </div>
      <div class="tags"><span>r</span><span>rcpp</span></div>
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/16325624/laxmi-agarwal" target="_blank"><img src="https://www.gravatar.com/avatar/b2fc901c27ca6c4aa10b69b90755cc29?s=256&d=identicon&r=PG&f=1" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/16325624/laxmi-agarwal" target="_blank">Laxmi Agarwal</a>
        asked Jul 17 '21 at 00:14
      </div>
      <div class="body">
        <details>
          <summary>Click to expand question</summary>
          <p>I have been trying to create a database and installed the &quot;DBI&quot; package, but I am still facing this error. I reinstalled DBI and RSQLite package, but they don’t seem to work.</p>
<pre><code>library(&quot;DBI&quot;)
con &lt;- dbConnect
(RSQLite::SQLite(), dbname = &quot;:memory:&quot;)
dbListTables(con)
</code></pre>
<p>Error:</p>
<blockquote>
<p>Error in connection_connect(dbname, loadable.extensions, flags, vfs, extended_types) : function 'Rcpp_precious_remove' not provided by package 'Rcpp'</p>
</blockquote>

        </details>
      </div>
    </div>

  </div>

  <div class="answer">

    <div class="stats">
      <div class="votes answer-accepted-FALSE">
        <span class="score">50</span>
        <div class="viewcount">votes</div>
      </div>
    </div>

    <div class="content">
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/16474343/daniela" target="_blank"><img src="https://lh3.googleusercontent.com/a/AATXAJx-bCrWkAhJO6SMiFsagpguHgnl25UKu7qjUKl6=k-s256" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/16474343/daniela" target="_blank">Daniela</a>
        replied Jul 18 '21 at 12:46
      </div>
      <div class="body">
        <details>
          <summary>Click to expand answer</summary>
          <p>I have been trying to create a database and installed the &quot;DBI&quot; package, but I am still facing this error. I reinstalled DBI and RSQLite package, but they don’t seem to work.</p>
<pre><code>library(&quot;DBI&quot;)
con &lt;- dbConnect
(RSQLite::SQLite(), dbname = &quot;:memory:&quot;)
dbListTables(con)
</code></pre>
<p>Error:</p>
<blockquote>
<p>Error in connection_connect(dbname, loadable.extensions, flags, vfs, extended_types) : function 'Rcpp_precious_remove' not provided by package 'Rcpp'</p>
</blockquote>

        </details>
      </div>
    </div>

  </div>

</article> <article class="qa" id="qa-11300048">

  <div class="question">

    <div class="stats">
      <div class="votes">
        <span class="score">15</span>
        <div class="viewcount">votes</div>
      </div>
      <div class="views">
        <span class="score">5.2k</span>
        <div class="viewcount">views</div>
      </div>
    </div>

    <div class="content">
      <div class="title">
        <h3>Rcpp pass by reference vs. by value</h3>
        <a href="https://stackoverflow.com/questions/11300048/rcpp-pass-by-reference-vs-by-value" target="_blank">[see original]</a>
      </div>
      <div class="tags"><span>r</span><span>rcpp</span></div>
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/636656/ari-b-friedman" target="_blank"><img src="https://www.gravatar.com/avatar/5a804caeb905aec31a7531d38314bf16?s=256&d=identicon&r=PG" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/636656/ari-b-friedman" target="_blank">Ari B. Friedman</a>
        asked Jul 02 '12 at 19:36
      </div>
      <div class="body">
        <details>
          <summary>Click to expand question</summary>
          <p>I made a first stab at an Rcpp function via <code>inline</code> and it solved my speed problem (thanks Dirk!):
<a href="https://stackoverflow.com/questions/11275187/r-replacing-negative-values-by-zero/11275230#11275230">Replace negative values by zero</a></p>
<p>The initial version looked like this:</p>
<pre><code>library(inline)
cpp_if_src &lt;- '
  Rcpp::NumericVector xa(a);
  int n_xa = xa.size();
  for(int i=0; i &lt; n_xa; i++) {
    if(xa[i]&lt;0) xa[i] = 0;
  }
  return xa;
'
cpp_if &lt;- cxxfunction(signature(a=&quot;numeric&quot;), cpp_if_src, plugin=&quot;Rcpp&quot;)
</code></pre>
<p>But when called <code>cpp_if(p)</code>, it overwrote <code>p</code> with the output, which was not as intended.  So I assumed it was passing by reference.</p>
<p>So I fixed it with the following version:</p>
<pre><code>library(inline)
cpp_if_src &lt;- '
  Rcpp::NumericVector xa(a);
  int n_xa = xa.size();
  Rcpp::NumericVector xr(a);
  for(int i=0; i &lt; n_xa; i++) {
    if(xr[i]&lt;0) xr[i] = 0;
  }
  return xr;
'
cpp_if &lt;- cxxfunction(signature(a=&quot;numeric&quot;), cpp_if_src, plugin=&quot;Rcpp&quot;)
</code></pre>
<p>Which seemed to work.  But now the original version doesn't overwrite its input anymore when I re-load it into R (i.e. the same exact code now doesn't overwrite its input):</p>
<pre><code>&gt; cpp_if_src &lt;- '
+   Rcpp::NumericVector xa(a);
+   int n_xa = xa.size();
+   for(int i=0; i &lt; n_xa; i++) {
+     if(xa[i]&lt;0) xa[i] = 0;
+   }
+   return xa;
+ '
&gt; cpp_if &lt;- cxxfunction(signature(a=&quot;numeric&quot;), cpp_if_src, plugin=&quot;Rcpp&quot;)
&gt; 
&gt; p
 [1] -5 -4 -3 -2 -1  0  1  2  3  4  5
&gt; cpp_if(p)
 [1] 0 0 0 0 0 0 1 2 3 4 5
&gt; p
 [1] -5 -4 -3 -2 -1  0  1  2  3  4  5
</code></pre>
<p>I'm not the only one who has tried to replicate this behavior and found inconsistent results:</p>
<p><a href="https://chat.stackoverflow.com/transcript/message/4357344#4357344">https://chat.stackoverflow.com/transcript/message/4357344#4357344</a></p>
<p>What's going on here?</p>

        </details>
      </div>
    </div>

  </div>

  <div class="answer">

    <div class="stats">
      <div class="votes answer-accepted-TRUE">
        <span class="score">21</span>
        <div class="viewcount">votes</div>
      </div>
    </div>

    <div class="content">
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/143305/dirk-eddelbuettel" target="_blank"><img src="https://www.gravatar.com/avatar/4e96ca7ae02c37e7d940d17997d780e5?s=256&d=identicon&r=PG" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/143305/dirk-eddelbuettel" target="_blank">Dirk Eddelbuettel</a>
        replied Jul 02 '12 at 20:28
      </div>
      <div class="body">
        <details>
          <summary>Click to expand answer</summary>
          <p>I made a first stab at an Rcpp function via <code>inline</code> and it solved my speed problem (thanks Dirk!):
<a href="https://stackoverflow.com/questions/11275187/r-replacing-negative-values-by-zero/11275230#11275230">Replace negative values by zero</a></p>
<p>The initial version looked like this:</p>
<pre><code>library(inline)
cpp_if_src &lt;- '
  Rcpp::NumericVector xa(a);
  int n_xa = xa.size();
  for(int i=0; i &lt; n_xa; i++) {
    if(xa[i]&lt;0) xa[i] = 0;
  }
  return xa;
'
cpp_if &lt;- cxxfunction(signature(a=&quot;numeric&quot;), cpp_if_src, plugin=&quot;Rcpp&quot;)
</code></pre>
<p>But when called <code>cpp_if(p)</code>, it overwrote <code>p</code> with the output, which was not as intended.  So I assumed it was passing by reference.</p>
<p>So I fixed it with the following version:</p>
<pre><code>library(inline)
cpp_if_src &lt;- '
  Rcpp::NumericVector xa(a);
  int n_xa = xa.size();
  Rcpp::NumericVector xr(a);
  for(int i=0; i &lt; n_xa; i++) {
    if(xr[i]&lt;0) xr[i] = 0;
  }
  return xr;
'
cpp_if &lt;- cxxfunction(signature(a=&quot;numeric&quot;), cpp_if_src, plugin=&quot;Rcpp&quot;)
</code></pre>
<p>Which seemed to work.  But now the original version doesn't overwrite its input anymore when I re-load it into R (i.e. the same exact code now doesn't overwrite its input):</p>
<pre><code>&gt; cpp_if_src &lt;- '
+   Rcpp::NumericVector xa(a);
+   int n_xa = xa.size();
+   for(int i=0; i &lt; n_xa; i++) {
+     if(xa[i]&lt;0) xa[i] = 0;
+   }
+   return xa;
+ '
&gt; cpp_if &lt;- cxxfunction(signature(a=&quot;numeric&quot;), cpp_if_src, plugin=&quot;Rcpp&quot;)
&gt; 
&gt; p
 [1] -5 -4 -3 -2 -1  0  1  2  3  4  5
&gt; cpp_if(p)
 [1] 0 0 0 0 0 0 1 2 3 4 5
&gt; p
 [1] -5 -4 -3 -2 -1  0  1  2  3  4  5
</code></pre>
<p>I'm not the only one who has tried to replicate this behavior and found inconsistent results:</p>
<p><a href="https://chat.stackoverflow.com/transcript/message/4357344#4357344">https://chat.stackoverflow.com/transcript/message/4357344#4357344</a></p>
<p>What's going on here?</p>

        </details>
      </div>
    </div>

  </div>

</article> <article class="qa" id="qa-11275187">

  <div class="question">

    <div class="stats">
      <div class="votes">
        <span class="score">27</span>
        <div class="viewcount">votes</div>
      </div>
      <div class="views">
        <span class="score">75.9k</span>
        <div class="viewcount">views</div>
      </div>
    </div>

    <div class="content">
      <div class="title">
        <h3>Replace negative values by zero</h3>
        <a href="https://stackoverflow.com/questions/11275187/replace-negative-values-by-zero" target="_blank">[see original]</a>
      </div>
      <div class="tags"><span>r</span><span>if-statement</span><span>for-loop</span><span>conditional-statements</span><span>rcpp</span></div>
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/1403232/fabian-stolz" target="_blank"><img src="https://www.gravatar.com/avatar/83158c1b3e818e3e3477baa50b2afa02?s=256&d=identicon&r=PG" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/1403232/fabian-stolz" target="_blank">Fabian Stolz</a>
        asked Jun 30 '12 at 15:09
      </div>
      <div class="body">
        <details>
          <summary>Click to expand question</summary>
          <p>We want to set all values in an array zero that are negative.</p>

<p>I tried out a a lot of stuff but did not yet achieve a working solution.
I thought about a for loop with condition, however this seems not to work.</p>

<pre><code>#pred_precipitation is our array
pred_precipitation &lt;-rnorm(25,2,4)     

for (i in nrow(pred_precipitation))
{
  if (pred_precipitation[i]&lt;0) {pred_precipitation[i] = 0}
  else{pred_precipitation[i] = pred_precipitation[i]}
}
</code></pre>

        </details>
      </div>
    </div>

  </div>

  <div class="answer">

    <div class="stats">
      <div class="votes answer-accepted-TRUE">
        <span class="score">66</span>
        <div class="viewcount">votes</div>
      </div>
    </div>

    <div class="content">
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/636656/ari-b-friedman" target="_blank"><img src="https://www.gravatar.com/avatar/5a804caeb905aec31a7531d38314bf16?s=256&d=identicon&r=PG" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/636656/ari-b-friedman" target="_blank">Ari B. Friedman</a>
        replied Jun 30 '12 at 15:15
      </div>
      <div class="body">
        <details>
          <summary>Click to expand answer</summary>
          <p>We want to set all values in an array zero that are negative.</p>

<p>I tried out a a lot of stuff but did not yet achieve a working solution.
I thought about a for loop with condition, however this seems not to work.</p>

<pre><code>#pred_precipitation is our array
pred_precipitation &lt;-rnorm(25,2,4)     

for (i in nrow(pred_precipitation))
{
  if (pred_precipitation[i]&lt;0) {pred_precipitation[i] = 0}
  else{pred_precipitation[i] = pred_precipitation[i]}
}
</code></pre>

        </details>
      </div>
    </div>

  </div>

</article> <article class="qa" id="qa-6074310">

  <div class="question">

    <div class="stats">
      <div class="votes">
        <span class="score">16</span>
        <div class="viewcount">votes</div>
      </div>
      <div class="views">
        <span class="score">3.6k</span>
        <div class="viewcount">views</div>
      </div>
    </div>

    <div class="content">
      <div class="title">
        <h3>Using Rcpp within parallel code via snow to make a cluster</h3>
        <a href="https://stackoverflow.com/questions/6074310/using-rcpp-within-parallel-code-via-snow-to-make-a-cluster" target="_blank">[see original]</a>
      </div>
      <div class="tags"><span>r</span><span>rcpp</span><span>snow</span></div>
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/342331/vincent" target="_blank"><img src="https://www.gravatar.com/avatar/7f2a5934e991701caf859ae8f770c719?s=256&d=identicon&r=PG" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/342331/vincent" target="_blank">Vincent</a>
        asked May 20 '11 at 15:40
      </div>
      <div class="body">
        <details>
          <summary>Click to expand question</summary>
          <p>I've written a function in <code>Rcpp</code> and compiled it with <code>inline</code>. Now, I want to run it in parallel on different cores, but I'm getting a strange error. Here's a minimal example, where the function <code>funCPP1</code> can be compiled and runs well by itself, but cannot be called by <code>snow</code>'s <code>clusterCall</code> function. The function runs well as a single process, but gives the following error when ran in parallel: </p>

<pre><code>Error in checkForRemoteErrors(lapply(cl, recvResult)) : 
  2 nodes produced errors; first error: NULL value passed as symbol address
</code></pre>

<p>And here is some code:</p>

<pre><code>## Load and compile
library(inline)
library(Rcpp)
library(snow)
src1 &lt;- '
     Rcpp::NumericMatrix xbem(xbe);
     int nrows = xbem.nrow();
     Rcpp::NumericVector gv(g);
     for (int i = 1; i &lt; nrows; i++) {
      xbem(i,_) = xbem(i-1,_) * gv[0] + xbem(i,_);
     }
     return xbem;
'
funCPP1 &lt;- cxxfunction(signature(xbe = "numeric", g="numeric"),body = src1, plugin="Rcpp")

## Single process
A &lt;- matrix(rnorm(400), 20,20)
funCPP1(A, 0.5)

## Parallel
cl &lt;- makeCluster(2, type = "SOCK") 
clusterExport(cl, 'funCPP1') 
clusterCall(cl, funCPP1, A, 0.5)
</code></pre>

        </details>
      </div>
    </div>

  </div>

  <div class="answer">

    <div class="stats">
      <div class="votes answer-accepted-TRUE">
        <span class="score">19</span>
        <div class="viewcount">votes</div>
      </div>
    </div>

    <div class="content">
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/143305/dirk-eddelbuettel" target="_blank"><img src="https://www.gravatar.com/avatar/4e96ca7ae02c37e7d940d17997d780e5?s=256&d=identicon&r=PG" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/143305/dirk-eddelbuettel" target="_blank">Dirk Eddelbuettel</a>
        replied May 20 '11 at 15:47
      </div>
      <div class="body">
        <details>
          <summary>Click to expand answer</summary>
          <p>I've written a function in <code>Rcpp</code> and compiled it with <code>inline</code>. Now, I want to run it in parallel on different cores, but I'm getting a strange error. Here's a minimal example, where the function <code>funCPP1</code> can be compiled and runs well by itself, but cannot be called by <code>snow</code>'s <code>clusterCall</code> function. The function runs well as a single process, but gives the following error when ran in parallel: </p>

<pre><code>Error in checkForRemoteErrors(lapply(cl, recvResult)) : 
  2 nodes produced errors; first error: NULL value passed as symbol address
</code></pre>

<p>And here is some code:</p>

<pre><code>## Load and compile
library(inline)
library(Rcpp)
library(snow)
src1 &lt;- '
     Rcpp::NumericMatrix xbem(xbe);
     int nrows = xbem.nrow();
     Rcpp::NumericVector gv(g);
     for (int i = 1; i &lt; nrows; i++) {
      xbem(i,_) = xbem(i-1,_) * gv[0] + xbem(i,_);
     }
     return xbem;
'
funCPP1 &lt;- cxxfunction(signature(xbe = "numeric", g="numeric"),body = src1, plugin="Rcpp")

## Single process
A &lt;- matrix(rnorm(400), 20,20)
funCPP1(A, 0.5)

## Parallel
cl &lt;- makeCluster(2, type = "SOCK") 
clusterExport(cl, 'funCPP1') 
clusterCall(cl, funCPP1, A, 0.5)
</code></pre>

        </details>
      </div>
    </div>

  </div>

</article> <article class="qa" id="qa-43597632">

  <div class="question">

    <div class="stats">
      <div class="votes">
        <span class="score">73</span>
        <div class="viewcount">votes</div>
      </div>
      <div class="views">
        <span class="score">27.2k</span>
        <div class="viewcount">views</div>
      </div>
    </div>

    <div class="content">
      <div class="title">
        <h3>Understanding the contents of the Makevars file in R (macros, variables, ~/.R/Makevars and pkg/src/Makevars)</h3>
        <a href="https://stackoverflow.com/questions/43597632/understanding-the-contents-of-the-makevars-file-in-r-macros-variables-r-ma" target="_blank">[see original]</a>
      </div>
      <div class="tags"><span>r</span><span>rcpp</span></div>
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/4477223/nobackingdown" target="_blank"><img src="https://www.gravatar.com/avatar/1dfba5f3175daef69e72064c908da5b0?s=256&d=identicon&r=PG&f=1" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/4477223/nobackingdown" target="_blank">NoBackingDown</a>
        asked Apr 24 '17 at 20:59
      </div>
      <div class="body">
        <details>
          <summary>Click to expand question</summary>
          <p>I am trying to understand the role and relationship of the macros/variables set in <code>~/.R/Makevars</code> and <code>package_directory/src/Makevars</code> when installing/building own R packages. Suppose these files look like</p>

<p>~/.R/Makevars</p>

<pre><code>CXX = g++
CXXSTD = -std=c++11
CXXFLAGS = -fsanitize=undefined,address -fno-omit-frame-pointer

CXX98 = g++
CXX98STD = -std=c++98

CXX11 = g++
CXX11STD = -std=c++11

CXX14 = g++
CXX14STD = -std=c++14
</code></pre>

<p>package_directory/src/Makevars</p>

<pre><code>PKG_CPPFLAGS = -I../inst/include
CXX_STD = CXX11
</code></pre>

<p>As I understand it, with <code>CXX</code> we can select the compiler for C++ when building R packages, with <code>CXXSTD</code> we chose the standard and with <code>CXXFLAGS</code> we add compiler flags. With <code>PKG_CPPFLAGS</code> we add flags for the C++ preprocessor and with <code>CXX_STD</code> we tell that our packages uses C++11.</p>

<p>I have the following questions:</p>

<ul>
<li>What is the relationship between <code>CXX</code> and <code>CXX98</code>, <code>CXX11</code> and <code>CXX14</code>?</li>
<li>What is the meaning of, e.g., <code>CXX11STD = -std=c++11</code> if C++11 is already implied? Is it between choosing <code>-std=c++11</code> and <code>-std=gnu++11</code>? Should <code>-std=gnu++11</code> generally be avoided for portability reasons?</li>
<li>Could the flags for <code>CXXSTD</code> and <code>CXXFLAGS</code> not just be added to <code>CXX</code>, such that the first three lines reduce to <code>CXX = g++ -std=c++11 -fsanitize=undefined,address -fno-omit-frame-pointer</code>. What is the advantage in explicity specifying <code>CXXSTD</code> and <code>CXXFLAGS</code>?</li>
<li>How does <code>CXX_STD = CXX11</code> work? How is <code>CXX11</code> here related to <code>CXX11</code> in <code>~/.R/Makevars</code>?</li>
<li>What is the relationship between <code>CXXFLAGS</code> and <code>PKG_CXXFLAGS</code>(not included in my example)?   </li>
</ul>

<p>I am aware of the information contained in <a href="https://cran.r-project.org/doc/manuals/r-release/R-exts.html" rel="noreferrer">Writing R Extensions</a> and <a href="https://cran.r-project.org/doc/manuals/r-release/R-admin.html#Customizing-package-compilation" rel="noreferrer">R Installation and Administration</a>, but I am not able to extract more information beyond my current level of understanding to answer the above questions.</p>

<p>I am adding a <code>Rcpp</code> tag because I suppose that answers to these questions will be most relevant to users of <code>Rcpp</code>, but I am aware that this is probably not directly related to <code>Rcpp</code>, so the tag might be removed if deemed appropriate.</p>

        </details>
      </div>
    </div>

  </div>

  <div class="answer">

    <div class="stats">
      <div class="votes answer-accepted-TRUE">
        <span class="score">112</span>
        <div class="viewcount">votes</div>
      </div>
    </div>

    <div class="content">
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/1345455/coatless" target="_blank"><img src="https://i.stack.imgur.com/DrBTs.jpg?s=256&g=1" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/1345455/coatless" target="_blank">coatless</a>
        replied Apr 24 '17 at 23:30
      </div>
      <div class="body">
        <details>
          <summary>Click to expand answer</summary>
          <p>I am trying to understand the role and relationship of the macros/variables set in <code>~/.R/Makevars</code> and <code>package_directory/src/Makevars</code> when installing/building own R packages. Suppose these files look like</p>

<p>~/.R/Makevars</p>

<pre><code>CXX = g++
CXXSTD = -std=c++11
CXXFLAGS = -fsanitize=undefined,address -fno-omit-frame-pointer

CXX98 = g++
CXX98STD = -std=c++98

CXX11 = g++
CXX11STD = -std=c++11

CXX14 = g++
CXX14STD = -std=c++14
</code></pre>

<p>package_directory/src/Makevars</p>

<pre><code>PKG_CPPFLAGS = -I../inst/include
CXX_STD = CXX11
</code></pre>

<p>As I understand it, with <code>CXX</code> we can select the compiler for C++ when building R packages, with <code>CXXSTD</code> we chose the standard and with <code>CXXFLAGS</code> we add compiler flags. With <code>PKG_CPPFLAGS</code> we add flags for the C++ preprocessor and with <code>CXX_STD</code> we tell that our packages uses C++11.</p>

<p>I have the following questions:</p>

<ul>
<li>What is the relationship between <code>CXX</code> and <code>CXX98</code>, <code>CXX11</code> and <code>CXX14</code>?</li>
<li>What is the meaning of, e.g., <code>CXX11STD = -std=c++11</code> if C++11 is already implied? Is it between choosing <code>-std=c++11</code> and <code>-std=gnu++11</code>? Should <code>-std=gnu++11</code> generally be avoided for portability reasons?</li>
<li>Could the flags for <code>CXXSTD</code> and <code>CXXFLAGS</code> not just be added to <code>CXX</code>, such that the first three lines reduce to <code>CXX = g++ -std=c++11 -fsanitize=undefined,address -fno-omit-frame-pointer</code>. What is the advantage in explicity specifying <code>CXXSTD</code> and <code>CXXFLAGS</code>?</li>
<li>How does <code>CXX_STD = CXX11</code> work? How is <code>CXX11</code> here related to <code>CXX11</code> in <code>~/.R/Makevars</code>?</li>
<li>What is the relationship between <code>CXXFLAGS</code> and <code>PKG_CXXFLAGS</code>(not included in my example)?   </li>
</ul>

<p>I am aware of the information contained in <a href="https://cran.r-project.org/doc/manuals/r-release/R-exts.html" rel="noreferrer">Writing R Extensions</a> and <a href="https://cran.r-project.org/doc/manuals/r-release/R-admin.html#Customizing-package-compilation" rel="noreferrer">R Installation and Administration</a>, but I am not able to extract more information beyond my current level of understanding to answer the above questions.</p>

<p>I am adding a <code>Rcpp</code> tag because I suppose that answers to these questions will be most relevant to users of <code>Rcpp</code>, but I am aware that this is probably not directly related to <code>Rcpp</code>, so the tag might be removed if deemed appropriate.</p>

        </details>
      </div>
    </div>

  </div>

</article> <article class="qa" id="qa-48069990">

  <div class="question">

    <div class="stats">
      <div class="votes">
        <span class="score">6</span>
        <div class="viewcount">votes</div>
      </div>
      <div class="views">
        <span class="score">1.1k</span>
        <div class="viewcount">views</div>
      </div>
    </div>

    <div class="content">
      <div class="title">
        <h3>Multithreaded &amp; SIMD vectorized Mandelbrot in R using Rcpp &amp; OpenMP</h3>
        <a href="https://stackoverflow.com/questions/48069990/multithreaded-simd-vectorized-mandelbrot-in-r-using-rcpp-openmp" target="_blank">[see original]</a>
      </div>
      <div class="tags"><span>multithreading</span><span>openmp</span><span>rcpp</span><span>simd</span><span>mandelbrot</span></div>
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/1887645/tom-wenseleers" target="_blank"><img src="https://www.gravatar.com/avatar/066e53489a81a9cbc3e5986c5cd3c39d?s=256&d=identicon&r=PG" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/1887645/tom-wenseleers" target="_blank">Tom Wenseleers</a>
        asked Jan 03 '18 at 01:19
      </div>
      <div class="body">
        <details>
          <summary>Click to expand question</summary>
          <p>As an <code>OpenMP</code> &amp; <code>Rcpp</code> performance test I wanted to check how fast I could calculate the Mandelbrot set in R using the most straightforward and simple <code>Rcpp</code>+<code>OpenMP</code> implementation. Currently what I did was:</p>

<pre><code>#include &lt;Rcpp.h&gt;
#include &lt;omp.h&gt;
// [[Rcpp::plugins(openmp)]]

using namespace Rcpp;

// [[Rcpp::export]]
Rcpp::NumericMatrix mandelRcpp(const double x_min, const double x_max, const double y_min, const double y_max,
                         const int res_x, const int res_y, const int nb_iter) {
  Rcpp::NumericMatrix ret(res_x, res_y);
  double x_step = (x_max - x_min) / res_x;
  double y_step = (y_max - y_min) / res_y;
  int r,c;
#pragma omp parallel for default(shared) private(c) schedule(dynamic,1)
  for (r = 0; r &lt; res_y; r++) {
    for (c = 0; c &lt; res_x; c++) {
      double zx = 0.0, zy = 0.0, new_zx;
      double cx = x_min + c*x_step, cy = y_min + r*y_step;
      int n = 0;
      for (n=0;  (zx*zx + zy*zy &lt; 4.0 ) &amp;&amp; ( n &lt; nb_iter ); n++ ) {
        new_zx = zx*zx - zy*zy + cx;
        zy = 2.0*zx*zy + cy;
        zx = new_zx;
      }
      ret(c,r) = n;
    }
  }
  return ret;
}
</code></pre>

<p>And then in R:</p>

<pre><code>library(Rcpp)
sourceCpp("mandelRcpp.cpp")
xlims=c(-0.74877,-0.74872);
ylims=c(0.065053,0.065103);
x_res=y_res=1080L; nb_iter=10000L;
system.time(m &lt;- mandelRcpp(xlims[[1]], xlims[[2]], ylims[[1]], ylims[[2]], x_res, y_res, nb_iter)) 
# 0.92s
rainbow=c(rgb(0.47,0.11,0.53),rgb(0.27,0.18,0.73),rgb(0.25,0.39,0.81),rgb(0.30,0.57,0.75),rgb(0.39,0.67,0.60),rgb(0.51,0.73,0.44),rgb(0.67,0.74,0.32),rgb(0.81,0.71,0.26),rgb(0.89,0.60,0.22),rgb(0.89,0.39,0.18),rgb(0.86,0.13,0.13))
    cols=c(colorRampPalette(rainbow)(100),rev(colorRampPalette(rainbow)(100)),"black") # palette
par(mar=c(0, 0, 0, 0))
system.time(image(m^(1/7), col=cols, asp=diff(ylims)/diff(xlims), axes=F, useRaster=T)) 
# 0.5s
</code></pre>

<p><a href="https://i.stack.imgur.com/DWfh0.png" rel="nofollow noreferrer"><img src="https://i.stack.imgur.com/DWfh0.png" alt="enter image description here"></a></p>

<p>I was unsure though if there is any other obvious speed improvements I could take advantage of aside from OpenMP multithreading, e.g. via <code>simd</code> vectorization? (using simd options in the openmp <code>#pragma</code> didn't seem to do anything)</p>

<p>PS at first my code was crashing but I later found this was solved by replacing <code>ret[r,c] = n;</code> with <code>ret(r,c) = n;</code>
Using Armadillo classes as suggested in the answer below make things very slightly faster, though the timings are almost the same. Also flipped around <code>x</code> and <code>y</code> so it comes out in the right orientation when plotted with <code>image()</code>. Using 8 threads speed is ca. 350 times faster than the vectorized plain R Mandelbrot version <a href="https://github.com/mylesmharrison/mandelbrot/blob/master/mandelbrot.R" rel="nofollow noreferrer">here</a> and also about 7.3 times faster than the (non-multithreaded) Python/Numba version <a href="https://www.ibm.com/developerworks/community/blogs/jfp/entry/How_To_Compute_Mandelbrodt_Set_Quickly?lang=en" rel="nofollow noreferrer">here</a> (similar to PyCUDA or PyOpenCL speeds), so quite happy with that... <a href="https://stackoverflow.com/questions/48119360/performant-2d-opengl-graphics-in-r-for-fast-display-of-raster-image-using-qtpain">Rasterizing/display now seems the bottleneck in R....</a></p>

        </details>
      </div>
    </div>

  </div>

  <div class="answer">

    <div class="stats">
      <div class="votes answer-accepted-FALSE">
        <span class="score">5</span>
        <div class="viewcount">votes</div>
      </div>
    </div>

    <div class="content">
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/2542702/z-boson" target="_blank"><img src="https://i.stack.imgur.com/fW5ka.jpg?s=256&g=1" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/2542702/z-boson" target="_blank">Z boson</a>
        replied Jan 16 '18 at 14:36
      </div>
      <div class="body">
        <details>
          <summary>Click to expand answer</summary>
          <p>As an <code>OpenMP</code> &amp; <code>Rcpp</code> performance test I wanted to check how fast I could calculate the Mandelbrot set in R using the most straightforward and simple <code>Rcpp</code>+<code>OpenMP</code> implementation. Currently what I did was:</p>

<pre><code>#include &lt;Rcpp.h&gt;
#include &lt;omp.h&gt;
// [[Rcpp::plugins(openmp)]]

using namespace Rcpp;

// [[Rcpp::export]]
Rcpp::NumericMatrix mandelRcpp(const double x_min, const double x_max, const double y_min, const double y_max,
                         const int res_x, const int res_y, const int nb_iter) {
  Rcpp::NumericMatrix ret(res_x, res_y);
  double x_step = (x_max - x_min) / res_x;
  double y_step = (y_max - y_min) / res_y;
  int r,c;
#pragma omp parallel for default(shared) private(c) schedule(dynamic,1)
  for (r = 0; r &lt; res_y; r++) {
    for (c = 0; c &lt; res_x; c++) {
      double zx = 0.0, zy = 0.0, new_zx;
      double cx = x_min + c*x_step, cy = y_min + r*y_step;
      int n = 0;
      for (n=0;  (zx*zx + zy*zy &lt; 4.0 ) &amp;&amp; ( n &lt; nb_iter ); n++ ) {
        new_zx = zx*zx - zy*zy + cx;
        zy = 2.0*zx*zy + cy;
        zx = new_zx;
      }
      ret(c,r) = n;
    }
  }
  return ret;
}
</code></pre>

<p>And then in R:</p>

<pre><code>library(Rcpp)
sourceCpp("mandelRcpp.cpp")
xlims=c(-0.74877,-0.74872);
ylims=c(0.065053,0.065103);
x_res=y_res=1080L; nb_iter=10000L;
system.time(m &lt;- mandelRcpp(xlims[[1]], xlims[[2]], ylims[[1]], ylims[[2]], x_res, y_res, nb_iter)) 
# 0.92s
rainbow=c(rgb(0.47,0.11,0.53),rgb(0.27,0.18,0.73),rgb(0.25,0.39,0.81),rgb(0.30,0.57,0.75),rgb(0.39,0.67,0.60),rgb(0.51,0.73,0.44),rgb(0.67,0.74,0.32),rgb(0.81,0.71,0.26),rgb(0.89,0.60,0.22),rgb(0.89,0.39,0.18),rgb(0.86,0.13,0.13))
    cols=c(colorRampPalette(rainbow)(100),rev(colorRampPalette(rainbow)(100)),"black") # palette
par(mar=c(0, 0, 0, 0))
system.time(image(m^(1/7), col=cols, asp=diff(ylims)/diff(xlims), axes=F, useRaster=T)) 
# 0.5s
</code></pre>

<p><a href="https://i.stack.imgur.com/DWfh0.png" rel="nofollow noreferrer"><img src="https://i.stack.imgur.com/DWfh0.png" alt="enter image description here"></a></p>

<p>I was unsure though if there is any other obvious speed improvements I could take advantage of aside from OpenMP multithreading, e.g. via <code>simd</code> vectorization? (using simd options in the openmp <code>#pragma</code> didn't seem to do anything)</p>

<p>PS at first my code was crashing but I later found this was solved by replacing <code>ret[r,c] = n;</code> with <code>ret(r,c) = n;</code>
Using Armadillo classes as suggested in the answer below make things very slightly faster, though the timings are almost the same. Also flipped around <code>x</code> and <code>y</code> so it comes out in the right orientation when plotted with <code>image()</code>. Using 8 threads speed is ca. 350 times faster than the vectorized plain R Mandelbrot version <a href="https://github.com/mylesmharrison/mandelbrot/blob/master/mandelbrot.R" rel="nofollow noreferrer">here</a> and also about 7.3 times faster than the (non-multithreaded) Python/Numba version <a href="https://www.ibm.com/developerworks/community/blogs/jfp/entry/How_To_Compute_Mandelbrodt_Set_Quickly?lang=en" rel="nofollow noreferrer">here</a> (similar to PyCUDA or PyOpenCL speeds), so quite happy with that... <a href="https://stackoverflow.com/questions/48119360/performant-2d-opengl-graphics-in-r-for-fast-display-of-raster-image-using-qtpain">Rasterizing/display now seems the bottleneck in R....</a></p>

        </details>
      </div>
    </div>

  </div>

</article> <article class="qa" id="qa-5233769">

  <div class="question">

    <div class="stats">
      <div class="votes">
        <span class="score">52</span>
        <div class="viewcount">votes</div>
      </div>
      <div class="views">
        <span class="score">76.6k</span>
        <div class="viewcount">views</div>
      </div>
    </div>

    <div class="content">
      <div class="title">
        <h3>Practical limits of R data frame</h3>
        <a href="https://stackoverflow.com/questions/5233769/practical-limits-of-r-data-frame" target="_blank">[see original]</a>
      </div>
      <div class="tags"><span>r</span><span>performance</span><span>dataframe</span><span>rcpp</span></div>
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/220669/egon" target="_blank"><img src="https://www.gravatar.com/avatar/0932d5b60d6a0023cbbb97764117589c?s=256&d=identicon&r=PG" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/220669/egon" target="_blank">Egon</a>
        asked Mar 08 '11 at 14:24
      </div>
      <div class="body">
        <details>
          <summary>Click to expand question</summary>
          <p>I have been reading about how read.table is not efficient for large data files. Also how R is not suited for large data sets. So I was wondering where I can find what the practical limits are and any performance charts for (1) Reading in data of various sizes (2) working with data of varying sizes. </p>

<p>In effect, I want to know when the performance deteriorates and when I hit a road block. Also any comparison against C++/MATLAB or other languages would be really helpful. finally if there is any special performance comparison for Rcpp and RInside, that would be great!</p>

        </details>
      </div>
    </div>

  </div>

  <div class="answer">

    <div class="stats">
      <div class="votes answer-accepted-TRUE">
        <span class="score">52</span>
        <div class="viewcount">votes</div>
      </div>
    </div>

    <div class="content">
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/378229/allan-engelhardt" target="_blank"><img src="https://www.gravatar.com/avatar/435a3e74513c0dd2639890afb8d31c55?s=256&d=identicon&r=PG" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/378229/allan-engelhardt" target="_blank">Allan Engelhardt</a>
        replied Mar 08 '11 at 15:07
      </div>
      <div class="body">
        <details>
          <summary>Click to expand answer</summary>
          <p>I have been reading about how read.table is not efficient for large data files. Also how R is not suited for large data sets. So I was wondering where I can find what the practical limits are and any performance charts for (1) Reading in data of various sizes (2) working with data of varying sizes. </p>

<p>In effect, I want to know when the performance deteriorates and when I hit a road block. Also any comparison against C++/MATLAB or other languages would be really helpful. finally if there is any special performance comparison for Rcpp and RInside, that would be great!</p>

        </details>
      </div>
    </div>

  </div>

</article> <article class="qa" id="qa-26241085">

  <div class="question">

    <div class="stats">
      <div class="votes">
        <span class="score">14</span>
        <div class="viewcount">votes</div>
      </div>
      <div class="views">
        <span class="score">3.9k</span>
        <div class="viewcount">views</div>
      </div>
    </div>

    <div class="content">
      <div class="title">
        <h3>Rcpp function check if missing value</h3>
        <a href="https://stackoverflow.com/questions/26241085/rcpp-function-check-if-missing-value" target="_blank">[see original]</a>
      </div>
      <div class="tags"><span>r</span><span>rcpp</span></div>
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/1259856/giorgio-spedicato" target="_blank"><img src="https://i.stack.imgur.com/b2wqN.jpg?s=256&g=1" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/1259856/giorgio-spedicato" target="_blank">Giorgio Spedicato</a>
        asked Oct 07 '14 at 16:45
      </div>
      <div class="body">
        <details>
          <summary>Click to expand question</summary>
          <p>I'm converting R based code into Rcpp based code. The head of my function is:</p>

<pre><code>NumericMatrix createMatrixOfLinkRatiosC(NumericMatrix matr, double threshold4Clean) {
int i,j; 
NumericMatrix myMatr(matr.nrow(),matr.ncol());
myMatr=matr;
....;

}
</code></pre>

<p>I want to handle call to the function where threshold4Clean is missing but I'm not finding how to do... Any help will be greatly appreciated.</p>

        </details>
      </div>
    </div>

  </div>

  <div class="answer">

    <div class="stats">
      <div class="votes answer-accepted-FALSE">
        <span class="score">31</span>
        <div class="viewcount">votes</div>
      </div>
    </div>

    <div class="content">
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/1342082/kevin-ushey" target="_blank"><img src="https://www.gravatar.com/avatar/1ef12d2cf78f28d7a1e76c8fc60978c8?s=256&d=identicon&r=PG" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/1342082/kevin-ushey" target="_blank">Kevin Ushey</a>
        replied Oct 08 '14 at 17:35
      </div>
      <div class="body">
        <details>
          <summary>Click to expand answer</summary>
          <p>I'm converting R based code into Rcpp based code. The head of my function is:</p>

<pre><code>NumericMatrix createMatrixOfLinkRatiosC(NumericMatrix matr, double threshold4Clean) {
int i,j; 
NumericMatrix myMatr(matr.nrow(),matr.ncol());
myMatr=matr;
....;

}
</code></pre>

<p>I want to handle call to the function where threshold4Clean is missing but I'm not finding how to do... Any help will be greatly appreciated.</p>

        </details>
      </div>
    </div>

  </div>

</article> <article class="qa" id="qa-20474303">

  <div class="question">

    <div class="stats">
      <div class="votes">
        <span class="score">19</span>
        <div class="viewcount">votes</div>
      </div>
      <div class="views">
        <span class="score">2.6k</span>
        <div class="viewcount">views</div>
      </div>
    </div>

    <div class="content">
      <div class="title">
        <h3>using C function from other package in Rcpp</h3>
        <a href="https://stackoverflow.com/questions/20474303/using-c-function-from-other-package-in-rcpp" target="_blank">[see original]</a>
      </div>
      <div class="tags"><span>c++</span><span>c</span><span>r</span><span>rcpp</span></div>
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/471093/baptiste" target="_blank"><img src="https://i.stack.imgur.com/9r2gc.png?s=256&g=1" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/471093/baptiste" target="_blank">baptiste</a>
        asked Dec 09 '13 at 15:28
      </div>
      <div class="body">
        <details>
          <summary>Click to expand question</summary>
          <p>I'm trying to call a C routine from the cubature package in a c++ function to perform multidimensional integration. </p>

<p>The basic R example I'm trying to reproduce is</p>

<pre><code>library(cubature)
integrand &lt;- function(x) sin(x)
adaptIntegrate(integrand, 0, pi)
</code></pre>

<p>I could just call this R function from Rcpp following <a href="http://gallery.rcpp.org/articles/r-function-from-c++/">this recipe from the gallery</a>, but there would be some performance penalty in switching back and forth from c/c++ to R. It seems more sensible to directly call the C function from C++.</p>

<p>The C routine <code>adapt_integrate</code> is exported from <code>cubature</code> with</p>

<pre><code> // R_RegisterCCallable("cubature", "adapt_integrate", (DL_FUNC) adapt_integrate);
</code></pre>

<p>I don't understand how to call it from c++, however. Here's my lame attempt,</p>

<pre><code>sourceCpp(code = '
#include &lt;Rcpp.h&gt;
using namespace Rcpp;

// [[Rcpp::export]]
double integrand(double x){
 return(sin(x));
}

// [[Rcpp::depends(cubature)]]
// [[Rcpp::export]]
Rcpp::List integratecpp(double llim, double ulim)
{
  Rcpp::Function p_cubature = R_GetCCallable("cubature", "adapt_integrate");

  Rcpp::List result = p_cubature(integrand, llim, ulim);
  return(result);
}
'
)

integratecpp(0, pi)
</code></pre>

<p>This fails to compile; clearly I'm doing something very silly and missing some important steps to convert the output of <code>R_GetCCallable</code> into an <code>Rcpp::Function</code> (or call it directly?). I've read several related posts dealing with function pointers, but haven't seen an example using an external C function.</p>

        </details>
      </div>
    </div>

  </div>

  <div class="answer">

    <div class="stats">
      <div class="votes answer-accepted-TRUE">
        <span class="score">9</span>
        <div class="viewcount">votes</div>
      </div>
    </div>

    <div class="content">
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/499163/romain-francois" target="_blank"><img src="https://i.stack.imgur.com/3TpUO.jpg?s=256&g=1" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/499163/romain-francois" target="_blank">Romain Francois</a>
        replied Dec 09 '13 at 16:51
      </div>
      <div class="body">
        <details>
          <summary>Click to expand answer</summary>
          <p>I'm trying to call a C routine from the cubature package in a c++ function to perform multidimensional integration. </p>

<p>The basic R example I'm trying to reproduce is</p>

<pre><code>library(cubature)
integrand &lt;- function(x) sin(x)
adaptIntegrate(integrand, 0, pi)
</code></pre>

<p>I could just call this R function from Rcpp following <a href="http://gallery.rcpp.org/articles/r-function-from-c++/">this recipe from the gallery</a>, but there would be some performance penalty in switching back and forth from c/c++ to R. It seems more sensible to directly call the C function from C++.</p>

<p>The C routine <code>adapt_integrate</code> is exported from <code>cubature</code> with</p>

<pre><code> // R_RegisterCCallable("cubature", "adapt_integrate", (DL_FUNC) adapt_integrate);
</code></pre>

<p>I don't understand how to call it from c++, however. Here's my lame attempt,</p>

<pre><code>sourceCpp(code = '
#include &lt;Rcpp.h&gt;
using namespace Rcpp;

// [[Rcpp::export]]
double integrand(double x){
 return(sin(x));
}

// [[Rcpp::depends(cubature)]]
// [[Rcpp::export]]
Rcpp::List integratecpp(double llim, double ulim)
{
  Rcpp::Function p_cubature = R_GetCCallable("cubature", "adapt_integrate");

  Rcpp::List result = p_cubature(integrand, llim, ulim);
  return(result);
}
'
)

integratecpp(0, pi)
</code></pre>

<p>This fails to compile; clearly I'm doing something very silly and missing some important steps to convert the output of <code>R_GetCCallable</code> into an <code>Rcpp::Function</code> (or call it directly?). I've read several related posts dealing with function pointers, but haven't seen an example using an external C function.</p>

        </details>
      </div>
    </div>

  </div>

</article> <article class="qa" id="qa-36594628">

  <div class="question">

    <div class="stats">
      <div class="votes">
        <span class="score">4</span>
        <div class="viewcount">votes</div>
      </div>
      <div class="views">
        <span class="score">1.6k</span>
        <div class="viewcount">views</div>
      </div>
    </div>

    <div class="content">
      <div class="title">
        <h3>Call a function from c++ via environment Rcpp</h3>
        <a href="https://stackoverflow.com/questions/36594628/call-a-function-from-c-via-environment-rcpp" target="_blank">[see original]</a>
      </div>
      <div class="tags"><span>r</span><span>rcpp</span></div>
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/6101494/skyindeer" target="_blank"><img src="https://www.gravatar.com/avatar/babfea64fd4ce3911bd010f2bc0cab69?s=256&d=identicon&r=PG" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/6101494/skyindeer" target="_blank">skyindeer</a>
        asked Apr 13 '16 at 09:48
      </div>
      <div class="body">
        <details>
          <summary>Click to expand question</summary>
          <p>I am considering calling a R function from c++ via environment, but I got an error, here is what I did</p>

<pre><code>#include &lt;Rcpp.h&gt;
using namespace Rcpp;



// [[Rcpp::export]]
NumericVector call(NumericVector x){
  Environment env = Environment::global_env();
  Function f = env["fivenum"];
  NumericVector res = f(x);
  return res;
}
</code></pre>

<p>Type <code>call(x)</code>, this is what I got,</p>

<pre><code>Error: cannot convert to function
</code></pre>

<p>I know I can do it right in another way,</p>

<pre><code>#include &lt;Rcpp.h&gt;

using namespace Rcpp;

// [[Rcpp::export]]
NumericVector callFunction(NumericVector x, Function f) {
    NumericVector res = f(x);
    return res;
}
</code></pre>

<p>and type</p>

<pre><code>callFunction(x,fivenum)
</code></pre>

<p>But still wondering why first method failed.</p>

        </details>
      </div>
    </div>

  </div>

  <div class="answer">

    <div class="stats">
      <div class="votes answer-accepted-TRUE">
        <span class="score">8</span>
        <div class="viewcount">votes</div>
      </div>
    </div>

    <div class="content">
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/316644/digemall" target="_blank"><img src="https://www.gravatar.com/avatar/9e45208f75c49a887e6b33cb4a65a428?s=256&d=identicon&r=PG" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/316644/digemall" target="_blank">digEmAll</a>
        replied Apr 13 '16 at 10:13
      </div>
      <div class="body">
        <details>
          <summary>Click to expand answer</summary>
          <p>I am considering calling a R function from c++ via environment, but I got an error, here is what I did</p>

<pre><code>#include &lt;Rcpp.h&gt;
using namespace Rcpp;



// [[Rcpp::export]]
NumericVector call(NumericVector x){
  Environment env = Environment::global_env();
  Function f = env["fivenum"];
  NumericVector res = f(x);
  return res;
}
</code></pre>

<p>Type <code>call(x)</code>, this is what I got,</p>

<pre><code>Error: cannot convert to function
</code></pre>

<p>I know I can do it right in another way,</p>

<pre><code>#include &lt;Rcpp.h&gt;

using namespace Rcpp;

// [[Rcpp::export]]
NumericVector callFunction(NumericVector x, Function f) {
    NumericVector res = f(x);
    return res;
}
</code></pre>

<p>and type</p>

<pre><code>callFunction(x,fivenum)
</code></pre>

<p>But still wondering why first method failed.</p>

        </details>
      </div>
    </div>

  </div>

</article> <article class="qa" id="qa-38016851">

  <div class="question">

    <div class="stats">
      <div class="votes">
        <span class="score">8</span>
        <div class="viewcount">votes</div>
      </div>
      <div class="views">
        <span class="score">7.4k</span>
        <div class="viewcount">views</div>
      </div>
    </div>

    <div class="content">
      <div class="title">
        <h3>Call R functions in Rcpp</h3>
        <a href="https://stackoverflow.com/questions/38016851/call-r-functions-in-rcpp" target="_blank">[see original]</a>
      </div>
      <div class="tags"><span>r</span><span>rcpp</span></div>
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/6378990/yuge-hao" target="_blank"><img src="https://graph.facebook.com/136244556727935/picture?type=large" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/6378990/yuge-hao" target="_blank">Yuge Hao</a>
        asked Jun 24 '16 at 15:20
      </div>
      <div class="body">
        <details>
          <summary>Click to expand question</summary>
          <p>I was trying to call the sd(x), which is a R function, in Rcpp. I've seen an example of calling the R function dbate(x) in Rcpp and it works perfectly.</p>

<pre><code>// dens calls the pdf of beta distribution in R
//[[Rcpp::export]]
double dens(double x, double a, double b)
{
    return R::dbeta(x,a,b,false);
}
</code></pre>

<p>But when I tired to apply this method to sd(x) as following, it went wrong.</p>

<pre><code>// std calls the sd function in R
//[[Rcpp::export]]
double std(NumericVector x)
{
  return R::sd(x);
}
</code></pre>

<p>Does anyone know why this doesn't work?</p>

        </details>
      </div>
    </div>

  </div>

  <div class="answer">

    <div class="stats">
      <div class="votes answer-accepted-FALSE">
        <span class="score">14</span>
        <div class="viewcount">votes</div>
      </div>
    </div>

    <div class="content">
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/1345455/coatless" target="_blank"><img src="https://i.stack.imgur.com/DrBTs.jpg?s=256&g=1" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/1345455/coatless" target="_blank">coatless</a>
        replied Jun 24 '16 at 16:03
      </div>
      <div class="body">
        <details>
          <summary>Click to expand answer</summary>
          <p>I was trying to call the sd(x), which is a R function, in Rcpp. I've seen an example of calling the R function dbate(x) in Rcpp and it works perfectly.</p>

<pre><code>// dens calls the pdf of beta distribution in R
//[[Rcpp::export]]
double dens(double x, double a, double b)
{
    return R::dbeta(x,a,b,false);
}
</code></pre>

<p>But when I tired to apply this method to sd(x) as following, it went wrong.</p>

<pre><code>// std calls the sd function in R
//[[Rcpp::export]]
double std(NumericVector x)
{
  return R::sd(x);
}
</code></pre>

<p>Does anyone know why this doesn't work?</p>

        </details>
      </div>
    </div>

  </div>

</article> <article class="qa" id="qa-19823915">

  <div class="question">

    <div class="stats">
      <div class="votes">
        <span class="score">13</span>
        <div class="viewcount">votes</div>
      </div>
      <div class="views">
        <span class="score">1.9k</span>
        <div class="viewcount">views</div>
      </div>
    </div>

    <div class="content">
      <div class="title">
        <h3>how can I handle vectors without knowing the type in Rcpp</h3>
        <a href="https://stackoverflow.com/questions/19823915/how-can-i-handle-vectors-without-knowing-the-type-in-rcpp" target="_blank">[see original]</a>
      </div>
      <div class="tags"><span>r</span><span>rcpp</span></div>
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/817778/eddi" target="_blank"><img src="https://www.gravatar.com/avatar/20cc8f574b01913048718f0abd4bf861?s=256&d=identicon&r=PG" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/817778/eddi" target="_blank">eddi</a>
        asked Nov 06 '13 at 22:12
      </div>
      <div class="body">
        <details>
          <summary>Click to expand question</summary>
          <p>I want to replicate the following R function in <code>Rcpp</code>:</p>

<pre><code>fR = function(x) x[1:2]

fR(c(1,2,3))
#[1] 1 2
fR(c('a','b','c'))
#[1] "a" "b"
</code></pre>

<p>I can do it for a fixed output type like so:</p>

<pre><code>library(inline)
library(Rcpp)

fint = cxxfunction(signature(x = "SEXP"), '
          List xin(x);
          IntegerVector xout;

          for (int i = 0; i &lt; 2; ++i) xout.push_back(xin[i]);

          return xout;', plugin = "Rcpp")
</code></pre>

<p>But this will only work for integers, and if I try replacing the <code>xout</code> type with <code>List</code> (or <code>GenericVector</code>, which are the same) - it works with any input type, but I get back a <code>list</code> instead of a vector.</p>

<p>What's the correct <code>Rcpp</code> way of doing this?</p>

        </details>
      </div>
    </div>

  </div>

  <div class="answer">

    <div class="stats">
      <div class="votes answer-accepted-TRUE">
        <span class="score">12</span>
        <div class="viewcount">votes</div>
      </div>
    </div>

    <div class="content">
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/499163/romain-francois" target="_blank"><img src="https://i.stack.imgur.com/3TpUO.jpg?s=256&g=1" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/499163/romain-francois" target="_blank">Romain Francois</a>
        replied Nov 07 '13 at 06:33
      </div>
      <div class="body">
        <details>
          <summary>Click to expand answer</summary>
          <p>I want to replicate the following R function in <code>Rcpp</code>:</p>

<pre><code>fR = function(x) x[1:2]

fR(c(1,2,3))
#[1] 1 2
fR(c('a','b','c'))
#[1] "a" "b"
</code></pre>

<p>I can do it for a fixed output type like so:</p>

<pre><code>library(inline)
library(Rcpp)

fint = cxxfunction(signature(x = "SEXP"), '
          List xin(x);
          IntegerVector xout;

          for (int i = 0; i &lt; 2; ++i) xout.push_back(xin[i]);

          return xout;', plugin = "Rcpp")
</code></pre>

<p>But this will only work for integers, and if I try replacing the <code>xout</code> type with <code>List</code> (or <code>GenericVector</code>, which are the same) - it works with any input type, but I get back a <code>list</code> instead of a vector.</p>

<p>What's the correct <code>Rcpp</code> way of doing this?</p>

        </details>
      </div>
    </div>

  </div>

</article> <article class="qa" id="qa-22828361">

  <div class="question">

    <div class="stats">
      <div class="votes">
        <span class="score">6</span>
        <div class="viewcount">votes</div>
      </div>
      <div class="views">
        <span class="score">3k</span>
        <div class="viewcount">views</div>
      </div>
    </div>

    <div class="content">
      <div class="title">
        <h3>Rcpp function to select (and to return) a sub-dataframe</h3>
        <a href="https://stackoverflow.com/questions/22828361/rcpp-function-to-select-and-to-return-a-sub-dataframe" target="_blank">[see original]</a>
      </div>
      <div class="tags"><span>r</span><span>rcpp</span></div>
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/1446572/sam" target="_blank"><img src="https://www.gravatar.com/avatar/5a9172eef9ca3713f8edf6dc8b73a2ce?s=256&d=identicon&r=PG&f=1" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/1446572/sam" target="_blank">Sam</a>
        asked Apr 03 '14 at 05:11
      </div>
      <div class="body">
        <details>
          <summary>Click to expand question</summary>
          <p>Is it possible to write a C++ function that gets an R dataFrame as input, then modifies the dataFrame (in our case taking a subset) and returns the new data frame (in this question, returning a sub-dataframe) ?
My code below may make my question more clear:</p>

<p><strong>code</strong>:</p>

<pre><code># Suppose I have the data frame below created in R:
myDF = data.frame(id = rep(c(1,2), each = 5), alph = letters[1:10], mess = rnorm(10))

# Suppose I want to write a C++ function that gets id as inout and returns 
# a sub-dataframe corresponding to that id (**If it's possible to return 
# DataFrame in C++**)

# Auxiliary function --&gt; helps get a sub vector:
arma::vec myVecSubset(arma::vec vecMain, arma::vec IDVec, int ID){
  arma::uvec AuxVec = find(IDVec == ID);
  arma::vec rslt = arma::vec(AuxVec.size());
  for (int i = 0; i &lt; AuxVec.size(); i++){
    rslt[i] = vecMain[AuxVec[i]];
  }
  return rslt;
}

# Here is my C++ function:
Rcpp::DataFrame myVecSubset(Rcpp::DataFrame myDF, int ID){
  arma::vec id = Rcpp::as&lt;arma::vec&gt;(myDF["id"]);
  arma::vec alph = Rcpp::as&lt;arma::vec&gt;(myDF["alpha"]);
  arma::vec mess = Rcpp::as&lt;arma::vec&gt;(myDF["mess"]);

  // here I take a sub-vector:
  arma::vec id_sub = myVecSubset(id, id, int ID);
  arma::vec alph_sub = myVecSubset(alph, id, int ID);
  arma::vec mess_sub = myVecSubset(mess, id, int ID);

  // here is the CHALLENGE: How to combine these vectors into a new data frame???
  ???
}
</code></pre>

<p>In summary, there are actually two main question:
1) Is there any better way to take the sub-dataframe above in C++? (wish I could simple say myDF[myDF$id == ID,]!!!)</p>

<p>2) Is there anyway that I can combine id_sub, alpha_sub, and mess_sub into an R data frame and return it?</p>

<p>I really appreciate your help.</p>

        </details>
      </div>
    </div>

  </div>

  <div class="answer">

    <div class="stats">
      <div class="votes answer-accepted-FALSE">
        <span class="score">10</span>
        <div class="viewcount">votes</div>
      </div>
    </div>

    <div class="content">
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/1342082/kevin-ushey" target="_blank"><img src="https://www.gravatar.com/avatar/1ef12d2cf78f28d7a1e76c8fc60978c8?s=256&d=identicon&r=PG" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/1342082/kevin-ushey" target="_blank">Kevin Ushey</a>
        replied Apr 03 '14 at 09:28
      </div>
      <div class="body">
        <details>
          <summary>Click to expand answer</summary>
          <p>Is it possible to write a C++ function that gets an R dataFrame as input, then modifies the dataFrame (in our case taking a subset) and returns the new data frame (in this question, returning a sub-dataframe) ?
My code below may make my question more clear:</p>

<p><strong>code</strong>:</p>

<pre><code># Suppose I have the data frame below created in R:
myDF = data.frame(id = rep(c(1,2), each = 5), alph = letters[1:10], mess = rnorm(10))

# Suppose I want to write a C++ function that gets id as inout and returns 
# a sub-dataframe corresponding to that id (**If it's possible to return 
# DataFrame in C++**)

# Auxiliary function --&gt; helps get a sub vector:
arma::vec myVecSubset(arma::vec vecMain, arma::vec IDVec, int ID){
  arma::uvec AuxVec = find(IDVec == ID);
  arma::vec rslt = arma::vec(AuxVec.size());
  for (int i = 0; i &lt; AuxVec.size(); i++){
    rslt[i] = vecMain[AuxVec[i]];
  }
  return rslt;
}

# Here is my C++ function:
Rcpp::DataFrame myVecSubset(Rcpp::DataFrame myDF, int ID){
  arma::vec id = Rcpp::as&lt;arma::vec&gt;(myDF["id"]);
  arma::vec alph = Rcpp::as&lt;arma::vec&gt;(myDF["alpha"]);
  arma::vec mess = Rcpp::as&lt;arma::vec&gt;(myDF["mess"]);

  // here I take a sub-vector:
  arma::vec id_sub = myVecSubset(id, id, int ID);
  arma::vec alph_sub = myVecSubset(alph, id, int ID);
  arma::vec mess_sub = myVecSubset(mess, id, int ID);

  // here is the CHALLENGE: How to combine these vectors into a new data frame???
  ???
}
</code></pre>

<p>In summary, there are actually two main question:
1) Is there any better way to take the sub-dataframe above in C++? (wish I could simple say myDF[myDF$id == ID,]!!!)</p>

<p>2) Is there anyway that I can combine id_sub, alpha_sub, and mess_sub into an R data frame and return it?</p>

<p>I really appreciate your help.</p>

        </details>
      </div>
    </div>

  </div>

</article> <article class="qa" id="qa-21225662">

  <div class="question">

    <div class="stats">
      <div class="votes">
        <span class="score">10</span>
        <div class="viewcount">votes</div>
      </div>
      <div class="views">
        <span class="score">6.4k</span>
        <div class="viewcount">views</div>
      </div>
    </div>

    <div class="content">
      <div class="title">
        <h3>calling a user-defined R function from C++ using Rcpp</h3>
        <a href="https://stackoverflow.com/questions/21225662/calling-a-user-defined-r-function-from-c-using-rcpp" target="_blank">[see original]</a>
      </div>
      <div class="tags"><span>r</span><span>rcpp</span></div>
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/1446572/sam" target="_blank"><img src="https://www.gravatar.com/avatar/5a9172eef9ca3713f8edf6dc8b73a2ce?s=256&d=identicon&r=PG&f=1" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/1446572/sam" target="_blank">Sam</a>
        asked Jan 20 '14 at 03:11
      </div>
      <div class="body">
        <details>
          <summary>Click to expand question</summary>
          <p>I have an R code with a bunch of user-defined R functions. I'm trying to make the code run faster and of course the best option is to use Rcpp. My code involves functions that call each other. Therefore, If I write some functions in C++, I should be able to call and to run some of my R functions in my c++ code. In a simple example consider the code below in R:</p>

<pre><code>mySum &lt;- function(x, y){
 return(2*x + 3*y)
}
x &lt;&lt;- 1
y &lt;&lt;- 1
</code></pre>

<p>Now consider the C++ code in which I'm trying to access the function above:</p>

<pre><code>#include &lt;Rcpp.h&gt;
using namespace Rcpp;

// [[Rcpp::export]]
int mySuminC(){
 Environment myEnv = Environment::global_env();
 Function mySum = myEnv["mySum"];
 int x = myEnv["x"];
 int y = myEnv["y"];
 return wrap(mySum(Rcpp::Named("x", x), Rcpp::Named("y", y)));
 }
</code></pre>

<p>When I source the file in R with the inline function sourceCpp(), I get the error:</p>

<pre><code> "invalid conversion from 'SEXPREC*' to int
</code></pre>

<p>Could anyone help me on debugging the code? Is my code efficient? Can it be summarized? Is there any better idea to use mySum function than what I did in my code?</p>

<p>Thanks very much for your help.</p>

        </details>
      </div>
    </div>

  </div>

  <div class="answer">

    <div class="stats">
      <div class="votes answer-accepted-TRUE">
        <span class="score">13</span>
        <div class="viewcount">votes</div>
      </div>
    </div>

    <div class="content">
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/1342082/kevin-ushey" target="_blank"><img src="https://www.gravatar.com/avatar/1ef12d2cf78f28d7a1e76c8fc60978c8?s=256&d=identicon&r=PG" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/1342082/kevin-ushey" target="_blank">Kevin Ushey</a>
        replied Jan 20 '14 at 03:42
      </div>
      <div class="body">
        <details>
          <summary>Click to expand answer</summary>
          <p>I have an R code with a bunch of user-defined R functions. I'm trying to make the code run faster and of course the best option is to use Rcpp. My code involves functions that call each other. Therefore, If I write some functions in C++, I should be able to call and to run some of my R functions in my c++ code. In a simple example consider the code below in R:</p>

<pre><code>mySum &lt;- function(x, y){
 return(2*x + 3*y)
}
x &lt;&lt;- 1
y &lt;&lt;- 1
</code></pre>

<p>Now consider the C++ code in which I'm trying to access the function above:</p>

<pre><code>#include &lt;Rcpp.h&gt;
using namespace Rcpp;

// [[Rcpp::export]]
int mySuminC(){
 Environment myEnv = Environment::global_env();
 Function mySum = myEnv["mySum"];
 int x = myEnv["x"];
 int y = myEnv["y"];
 return wrap(mySum(Rcpp::Named("x", x), Rcpp::Named("y", y)));
 }
</code></pre>

<p>When I source the file in R with the inline function sourceCpp(), I get the error:</p>

<pre><code> "invalid conversion from 'SEXPREC*' to int
</code></pre>

<p>Could anyone help me on debugging the code? Is my code efficient? Can it be summarized? Is there any better idea to use mySum function than what I did in my code?</p>

<p>Thanks very much for your help.</p>

        </details>
      </div>
    </div>

  </div>

</article> <article class="qa" id="qa-51110244">

  <div class="question">

    <div class="stats">
      <div class="votes">
        <span class="score">5</span>
        <div class="viewcount">votes</div>
      </div>
      <div class="views">
        <span class="score">727</span>
        <div class="viewcount">views</div>
      </div>
    </div>

    <div class="content">
      <div class="title">
        <h3>In Rcpp, how to get a user-defined structure from C into R</h3>
        <a href="https://stackoverflow.com/questions/51110244/in-rcpp-how-to-get-a-user-defined-structure-from-c-into-r" target="_blank">[see original]</a>
      </div>
      <div class="tags"><span>rcpp</span></div>
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/1229531/mark-bower" target="_blank"><img src="https://www.gravatar.com/avatar/5cc3bd54bff10b3e161b0ca9261dac0a?s=256&d=identicon&r=PG" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/1229531/mark-bower" target="_blank">Mark Bower</a>
        asked Jun 29 '18 at 22:45
      </div>
      <div class="body">
        <details>
          <summary>Click to expand question</summary>
          <p>Am using Rcpp packages and can get my C function to compile and run in R, but now I want to return a large, user-defined data structure to R. The fields in the structure are either numbers or strings - no new or odd types within the structure. The example below is simplified and doesn't compile, but it conveys the idea of my problem. </p>

<pre><code>    typedef struct {
        char*   firstname[128];
        char*   lastname[128];
        int      nbrOfSamples;
    } HEADER_INFO;

    // [[Rcpp::export]]
    HEADER_INFO* read_header(Rcpp::StringVector strings) {
        FILE *fp;
        MEF_HEADER_INFO *header;

        char * filename = (char*)(strings(0));
        char * password = (char*)(strings(1));

        header = (HEADER_INFO*)malloc(sizeof(HEADER_INFO));
        memset(header, 0, sizeof(HEADER_INFO));

        fp = fopen(filename, "r");
        (void)read_header(header, password);
        return header;
    }
</code></pre>

<p>I'm pretty sure that I could package the entries in the header back into a StringVector, but that seems like a brute-force approach. My question is whether a more elegant solution exists. It is not clear to me what form such a structure would even have in R: a named List?</p>

<p>Thanks!</p>

        </details>
      </div>
    </div>

  </div>

  <div class="answer">

    <div class="stats">
      <div class="votes answer-accepted-TRUE">
        <span class="score">9</span>
        <div class="viewcount">votes</div>
      </div>
    </div>

    <div class="content">
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/8416610/ralf-stubner" target="_blank"><img src="https://lh5.googleusercontent.com/-cmim3CrZ9Wo/AAAAAAAAAAI/AAAAAAAAAjs/hnKTOHALc6M/photo.jpg?sz=256" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/8416610/ralf-stubner" target="_blank">Ralf Stubner</a>
        replied Jul 01 '18 at 08:58
      </div>
      <div class="body">
        <details>
          <summary>Click to expand answer</summary>
          <p>Am using Rcpp packages and can get my C function to compile and run in R, but now I want to return a large, user-defined data structure to R. The fields in the structure are either numbers or strings - no new or odd types within the structure. The example below is simplified and doesn't compile, but it conveys the idea of my problem. </p>

<pre><code>    typedef struct {
        char*   firstname[128];
        char*   lastname[128];
        int      nbrOfSamples;
    } HEADER_INFO;

    // [[Rcpp::export]]
    HEADER_INFO* read_header(Rcpp::StringVector strings) {
        FILE *fp;
        MEF_HEADER_INFO *header;

        char * filename = (char*)(strings(0));
        char * password = (char*)(strings(1));

        header = (HEADER_INFO*)malloc(sizeof(HEADER_INFO));
        memset(header, 0, sizeof(HEADER_INFO));

        fp = fopen(filename, "r");
        (void)read_header(header, password);
        return header;
    }
</code></pre>

<p>I'm pretty sure that I could package the entries in the header back into a StringVector, but that seems like a brute-force approach. My question is whether a more elegant solution exists. It is not clear to me what form such a structure would even have in R: a named List?</p>

<p>Thanks!</p>

        </details>
      </div>
    </div>

  </div>

</article> <article class="qa" id="qa-43221681">

  <div class="question">

    <div class="stats">
      <div class="votes">
        <span class="score">4</span>
        <div class="viewcount">votes</div>
      </div>
      <div class="views">
        <span class="score">1.4k</span>
        <div class="viewcount">views</div>
      </div>
    </div>

    <div class="content">
      <div class="title">
        <h3>Changing R&#39;s Seed from Rcpp to Guarantee Reproducibility</h3>
        <a href="https://stackoverflow.com/questions/43221681/changing-rs-seed-from-rcpp-to-guarantee-reproducibility" target="_blank">[see original]</a>
      </div>
      <div class="tags"><span>c++</span><span>r</span><span>rcpp</span></div>
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/6378990/yuge-hao" target="_blank"><img src="https://graph.facebook.com/136244556727935/picture?type=large" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/6378990/yuge-hao" target="_blank">Yuge Hao</a>
        asked Apr 05 '17 at 04:13
      </div>
      <div class="body">
        <details>
          <summary>Click to expand question</summary>
          <p>I am trying to write a function r(d, n) in rcpp. The function returns n random draws from normal distribution N(0, d). This function should be well defined, therefore the function should return the same draws whenever the d and n do not change their value. </p>

<p>This won't be a problem if d is restricted to be integer, in which case I can set seed and do the job</p>

<pre><code>// set seed
// [[Rcpp::export]]
void set_seed(unsigned int seed) {
  Rcpp::Environment base_env("package:base");
  Rcpp::Function set_seed_r = base_env["set.seed"];
  set_seed_r(seed);  
}

// function r(d, n)
// [[Rcpp::export]]
vec randdraw(int d, int n){
  set_seed(d);
  vec out = randn(n);
  return out;
}
</code></pre>

<p>But clearly I don't want to restrict d to be integer. Ideally d should be double. Any thoughts? Thank you!</p>

        </details>
      </div>
    </div>

  </div>

  <div class="answer">

    <div class="stats">
      <div class="votes answer-accepted-FALSE">
        <span class="score">6</span>
        <div class="viewcount">votes</div>
      </div>
    </div>

    <div class="content">
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/1345455/coatless" target="_blank"><img src="https://i.stack.imgur.com/DrBTs.jpg?s=256&g=1" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/1345455/coatless" target="_blank">coatless</a>
        replied Apr 05 '17 at 05:58
      </div>
      <div class="body">
        <details>
          <summary>Click to expand answer</summary>
          <p>I am trying to write a function r(d, n) in rcpp. The function returns n random draws from normal distribution N(0, d). This function should be well defined, therefore the function should return the same draws whenever the d and n do not change their value. </p>

<p>This won't be a problem if d is restricted to be integer, in which case I can set seed and do the job</p>

<pre><code>// set seed
// [[Rcpp::export]]
void set_seed(unsigned int seed) {
  Rcpp::Environment base_env("package:base");
  Rcpp::Function set_seed_r = base_env["set.seed"];
  set_seed_r(seed);  
}

// function r(d, n)
// [[Rcpp::export]]
vec randdraw(int d, int n){
  set_seed(d);
  vec out = randn(n);
  return out;
}
</code></pre>

<p>But clearly I don't want to restrict d to be integer. Ideally d should be double. Any thoughts? Thank you!</p>

        </details>
      </div>
    </div>

  </div>

</article> <article class="qa" id="qa-18570526">

  <div class="question">

    <div class="stats">
      <div class="votes">
        <span class="score">10</span>
        <div class="viewcount">votes</div>
      </div>
      <div class="views">
        <span class="score">5.7k</span>
        <div class="viewcount">views</div>
      </div>
    </div>

    <div class="content">
      <div class="title">
        <h3>How to build a R package which use Rcpp with external c++ libraries?</h3>
        <a href="https://stackoverflow.com/questions/18570526/how-to-build-a-r-package-which-use-rcpp-with-external-c-libraries" target="_blank">[see original]</a>
      </div>
      <div class="tags"><span>rcpp</span></div>
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/1246858/xiaobo-gu" target="_blank"><img src="https://www.gravatar.com/avatar/6eaa01d279806c03eb466bcdb5555c42?s=256&d=identicon&r=PG&f=1" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/1246858/xiaobo-gu" target="_blank">Xiaobo Gu</a>
        asked Sep 02 '13 at 10:04
      </div>
      <div class="body">
        <details>
          <summary>Click to expand question</summary>
          <p>Such as boost, where can I specify the following: </p>

<pre><code>1.External c++ header file include path 
2.External c++ source file 
3.External c++ link library file path
</code></pre>

        </details>
      </div>
    </div>

  </div>

  <div class="answer">

    <div class="stats">
      <div class="votes answer-accepted-FALSE">
        <span class="score">14</span>
        <div class="viewcount">votes</div>
      </div>
    </div>

    <div class="content">
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/143305/dirk-eddelbuettel" target="_blank"><img src="https://www.gravatar.com/avatar/4e96ca7ae02c37e7d940d17997d780e5?s=256&d=identicon&r=PG" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/143305/dirk-eddelbuettel" target="_blank">Dirk Eddelbuettel</a>
        replied Sep 02 '13 at 18:01
      </div>
      <div class="body">
        <details>
          <summary>Click to expand answer</summary>
          <p>Such as boost, where can I specify the following: </p>

<pre><code>1.External c++ header file include path 
2.External c++ source file 
3.External c++ link library file path
</code></pre>

        </details>
      </div>
    </div>

  </div>

</article> <article class="qa" id="qa-46039132">

  <div class="question">

    <div class="stats">
      <div class="votes">
        <span class="score">8</span>
        <div class="viewcount">votes</div>
      </div>
      <div class="views">
        <span class="score">1.2k</span>
        <div class="viewcount">views</div>
      </div>
    </div>

    <div class="content">
      <div class="title">
        <h3>Renaming and Hiding an Exported Rcpp function in an R Package</h3>
        <a href="https://stackoverflow.com/questions/46039132/renaming-and-hiding-an-exported-rcpp-function-in-an-r-package" target="_blank">[see original]</a>
      </div>
      <div class="tags"><span>r</span><span>rcpp</span><span>r-package</span><span>roxygen2</span></div>
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/6193957/cello" target="_blank"><img src="https://www.gravatar.com/avatar/17c14b3be6cf866e1d856b272f01a6e8?s=256&d=identicon&r=PG&f=1" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/6193957/cello" target="_blank">Cello</a>
        asked Sep 04 '17 at 14:24
      </div>
      <div class="body">
        <details>
          <summary>Click to expand question</summary>
          <p>Writing an R package, I have a R function that calls a specific Rcpp function. The Rcpp function just serves as a helper function and I do not want to creat a .Rd file for it.
My solution so far is to export both functions in the Namespace file which causes the warning to create an .Rd file for the Rcpp function as soon as I run the check command. If I remove the helper function in the Namespace file, I get rid of this warning causing now the problem that the R function is not able to find it anymore. </p>

<p>Is there a way to solve this problem. That means to make the Rcpp function still visible for the R function and at the same time to get rid of the warning that there exists no .Rd file for the Rcpp function? </p>

<p>Thanks a lot :-)  </p>

        </details>
      </div>
    </div>

  </div>

  <div class="answer">

    <div class="stats">
      <div class="votes answer-accepted-FALSE">
        <span class="score">11</span>
        <div class="viewcount">votes</div>
      </div>
    </div>

    <div class="content">
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/1345455/coatless" target="_blank"><img src="https://i.stack.imgur.com/DrBTs.jpg?s=256&g=1" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/1345455/coatless" target="_blank">coatless</a>
        replied Sep 04 '17 at 15:16
      </div>
      <div class="body">
        <details>
          <summary>Click to expand answer</summary>
          <p>Writing an R package, I have a R function that calls a specific Rcpp function. The Rcpp function just serves as a helper function and I do not want to creat a .Rd file for it.
My solution so far is to export both functions in the Namespace file which causes the warning to create an .Rd file for the Rcpp function as soon as I run the check command. If I remove the helper function in the Namespace file, I get rid of this warning causing now the problem that the R function is not able to find it anymore. </p>

<p>Is there a way to solve this problem. That means to make the Rcpp function still visible for the R function and at the same time to get rid of the warning that there exists no .Rd file for the Rcpp function? </p>

<p>Thanks a lot :-)  </p>

        </details>
      </div>
    </div>

  </div>

</article> <article class="qa" id="qa-9949202">

  <div class="question">

    <div class="stats">
      <div class="votes">
        <span class="score">13</span>
        <div class="viewcount">votes</div>
      </div>
      <div class="views">
        <span class="score">5.3k</span>
        <div class="viewcount">views</div>
      </div>
    </div>

    <div class="content">
      <div class="title">
        <h3>1-dimensional Matrix is changed to a vector in R</h3>
        <a href="https://stackoverflow.com/questions/9949202/1-dimensional-matrix-is-changed-to-a-vector-in-r" target="_blank">[see original]</a>
      </div>
      <div class="tags"><span>r</span><span>vector</span><span>matrix</span><span>rcpp</span></div>
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/1259411/jona" target="_blank"><img src="https://www.gravatar.com/avatar/787b0f1aaa4cf330f8fc9ad679ee04e4?s=256&d=identicon&r=PG" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/1259411/jona" target="_blank">Jona</a>
        asked Mar 30 '12 at 19:19
      </div>
      <div class="body">
        <details>
          <summary>Click to expand question</summary>
          <pre><code>&gt; a&lt;-matrix(c(1:9),3,3)
&gt; a
     [,1] [,2] [,3]
[1,]    1    4    7
[2,]    2    5    8
[3,]    3    6    9
&gt; a[3,]*a[,3]  # I expect 1x1 matrix as result of this.
[1] 21 48 81
&gt; class(a)
[1] "matrix"
&gt; class(a[3,])
[1] "integer"
</code></pre>

<p>In R, 1-dimensional matrix is changed to a vector. Can I avoid this?
I would like to keep 1-D matrix as a matrix. Actually, I need to throw many kind of matrix to RcppArmadillo, even zero-D matrix. Changing matrix to vector by itself is my problem.</p>

        </details>
      </div>
    </div>

  </div>

  <div class="answer">

    <div class="stats">
      <div class="votes answer-accepted-TRUE">
        <span class="score">18</span>
        <div class="viewcount">votes</div>
      </div>
    </div>

    <div class="content">
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/324364/joran" target="_blank"><img src="https://i.stack.imgur.com/KIazX.jpg?s=256&g=1" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/324364/joran" target="_blank">joran</a>
        replied Mar 30 '12 at 19:21
      </div>
      <div class="body">
        <details>
          <summary>Click to expand answer</summary>
          <pre><code>&gt; a&lt;-matrix(c(1:9),3,3)
&gt; a
     [,1] [,2] [,3]
[1,]    1    4    7
[2,]    2    5    8
[3,]    3    6    9
&gt; a[3,]*a[,3]  # I expect 1x1 matrix as result of this.
[1] 21 48 81
&gt; class(a)
[1] "matrix"
&gt; class(a[3,])
[1] "integer"
</code></pre>

<p>In R, 1-dimensional matrix is changed to a vector. Can I avoid this?
I would like to keep 1-D matrix as a matrix. Actually, I need to throw many kind of matrix to RcppArmadillo, even zero-D matrix. Changing matrix to vector by itself is my problem.</p>

        </details>
      </div>
    </div>

  </div>

</article> <article class="qa" id="qa-45549992">

  <div class="question">

    <div class="stats">
      <div class="votes">
        <span class="score">9</span>
        <div class="viewcount">votes</div>
      </div>
      <div class="views">
        <span class="score">353</span>
        <div class="viewcount">views</div>
      </div>
    </div>

    <div class="content">
      <div class="title">
        <h3>Group vector on conditional sum</h3>
        <a href="https://stackoverflow.com/questions/45549992/group-vector-on-conditional-sum" target="_blank">[see original]</a>
      </div>
      <div class="tags"><span>r</span><span>performance</span><span>rcpp</span></div>
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/5635580/sotos" target="_blank"><img src="https://i.stack.imgur.com/00uoL.jpg?s=256&g=1" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/5635580/sotos" target="_blank">Sotos</a>
        asked Aug 07 '17 at 14:58
      </div>
      <div class="body">
        <details>
          <summary>Click to expand question</summary>
          <p>I want to group a vector based on the sum of the elements being less than or equal to <code>n</code>. Assume the following,</p>

<pre><code>set.seed(1)
x &lt;- sample(10, 20, replace = TRUE)
#[1]  3  4  6 10  3  9 10  7  7  1  3  2  7  4  8  5  8 10  4  8

#Where,
n = 15
</code></pre>

<p>The expected output would be to group values while their sum is &lt;= 15, i.e.</p>

<pre><code>y &lt;- c(1, 1, 1, 2, 2, 3, 4, 5 ,5, 5, 6, 6, 6, 7, 7, 8, 8, 9, 9, 10)
</code></pre>

<p>As you can see the sum is never greater than 15, </p>

<pre><code>sapply(split(x, y), sum)
# 1  2  3  4  5  6  7  8  9 10 
#13 13  9 10 15 12 12 13 14  8 
</code></pre>

<p><strong>NOTE:</strong> I will be running this on huge datasets (usually > 150 - 200GB) so efficiency is a must. </p>

<p>A method that I tried and comes close but fails is,</p>

<pre><code>as.integer(cut(cumsum(x), breaks = seq(0, max(cumsum(x)) + 15, 15)))
#[1] 1 1 1 2 2 3 3 4 4 4 5 5 5 6 6 6 7 8 8 8
</code></pre>

        </details>
      </div>
    </div>

  </div>

  <div class="answer">

    <div class="stats">
      <div class="votes answer-accepted-TRUE">
        <span class="score">4</span>
        <div class="viewcount">votes</div>
      </div>
    </div>

    <div class="content">
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/3048453/david" target="_blank"><img src="https://www.gravatar.com/avatar/ad7e81a9692871e7a60fc233a1bb114c?s=256&d=identicon&r=PG&f=1" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/3048453/david" target="_blank">David</a>
        replied Aug 07 '17 at 16:23
      </div>
      <div class="body">
        <details>
          <summary>Click to expand answer</summary>
          <p>I want to group a vector based on the sum of the elements being less than or equal to <code>n</code>. Assume the following,</p>

<pre><code>set.seed(1)
x &lt;- sample(10, 20, replace = TRUE)
#[1]  3  4  6 10  3  9 10  7  7  1  3  2  7  4  8  5  8 10  4  8

#Where,
n = 15
</code></pre>

<p>The expected output would be to group values while their sum is &lt;= 15, i.e.</p>

<pre><code>y &lt;- c(1, 1, 1, 2, 2, 3, 4, 5 ,5, 5, 6, 6, 6, 7, 7, 8, 8, 9, 9, 10)
</code></pre>

<p>As you can see the sum is never greater than 15, </p>

<pre><code>sapply(split(x, y), sum)
# 1  2  3  4  5  6  7  8  9 10 
#13 13  9 10 15 12 12 13 14  8 
</code></pre>

<p><strong>NOTE:</strong> I will be running this on huge datasets (usually > 150 - 200GB) so efficiency is a must. </p>

<p>A method that I tried and comes close but fails is,</p>

<pre><code>as.integer(cut(cumsum(x), breaks = seq(0, max(cumsum(x)) + 15, 15)))
#[1] 1 1 1 2 2 3 3 4 4 4 5 5 5 6 6 6 7 8 8 8
</code></pre>

        </details>
      </div>
    </div>

  </div>

</article> <article class="qa" id="qa-46473895">

  <div class="question">

    <div class="stats">
      <div class="votes">
        <span class="score">2</span>
        <div class="viewcount">votes</div>
      </div>
      <div class="views">
        <span class="score">849</span>
        <div class="viewcount">views</div>
      </div>
    </div>

    <div class="content">
      <div class="title">
        <h3>Calling R&#39;s optim function from within C++ using Rcpp</h3>
        <a href="https://stackoverflow.com/questions/46473895/calling-rs-optim-function-from-within-c-using-rcpp" target="_blank">[see original]</a>
      </div>
      <div class="tags"><span>c++</span><span>r</span><span>rcpp</span></div>
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/8690747/siqi-xiang" target="_blank"><img src="https://www.gravatar.com/avatar/f51c81ea9b13e506f8aa4d04e3a193f6?s=256&d=identicon&r=PG&f=1" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/8690747/siqi-xiang" target="_blank">Siqi.Xiang</a>
        asked Sep 28 '17 at 16:18
      </div>
      <div class="body">
        <details>
          <summary>Click to expand question</summary>
          <p>I'm new for Rcpp, and in my code, I must call the R function "optim" from C++. I referred to many examples, but there is still a mistake: "static assertion failed: cannot convert type to SEXP". Here is my code, and the problem is the last function:</p>

<pre><code>#include &lt;RcppArmadillo.h&gt;

using namespace Rcpp;
using namespace RcppArmadillo;
using namespace arma;
using namespace std;
// [[Rcpp::depends(RcppArmadillo)]]

// [[Rcpp::plugins(cpp11)]]

// [[Rcpp::export]]
double fr(arma::colvec x){
  double result = 100 * (x(2) - x(1) * x(1)) * (x(2) - x(1) * x(1)) + (1 -     x(1)) * (1 - x(1));
  return result;  
} 


typedef double (*funcPtr)(arma::colvec x);

// [[Rcpp::export]]
XPtr&lt;funcPtr&gt; putFunPtrInXPtr(){
  return(XPtr&lt;funcPtr&gt;(new funcPtr(&amp;fr)));
}


// [[Rcpp::export]]
arma::colvec callOptimFun(SEXP x) {

  RNGScope scope;

  Rcpp::Environment stats("package:stats");
  Rcpp::Function optim = stats["optim"];
  XPtr&lt;funcPtr&gt; xpfun = putFunPtrInXPtr();
  funcPtr fun = *xpfun;
  Rcpp::List y = optim(x, fun);
  arma::colvec r = y["par"];
  return r; 
}
</code></pre>

<p>Unfortunately, I have tried lots of methods for my last function, and all methods have the same error. These are my tries:
1.</p>

<pre><code>// [[Rcpp::export]]
Rcpp::List callOptimFun(arma::colvec x) {

  \\....
  Rcpp::List y = optim(x, fun);
  return y; 
}
</code></pre>

<p>2.</p>

<pre><code>// [[Rcpp::export]]
Rcpp::List callOptimFun(arma::colvec x) {

  \\....
  Rcpp::List y = optim(x, fun);
  return y; 
}
</code></pre>

<p>3.</p>

<pre><code>// [[Rcpp::export]]
Rcpp::List callOptimFun(SEXP x) {

  \\....
  Rcpp::List y = optim(x, fun);
  return y; 
}
</code></pre>

<p>I am not familiar with C++. What may be the problem? Thanks!</p>

        </details>
      </div>
    </div>

  </div>

  <div class="answer">

    <div class="stats">
      <div class="votes answer-accepted-TRUE">
        <span class="score">3</span>
        <div class="viewcount">votes</div>
      </div>
    </div>

    <div class="content">
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/1345455/coatless" target="_blank"><img src="https://i.stack.imgur.com/DrBTs.jpg?s=256&g=1" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/1345455/coatless" target="_blank">coatless</a>
        replied Sep 28 '17 at 17:35
      </div>
      <div class="body">
        <details>
          <summary>Click to expand answer</summary>
          <p>I'm new for Rcpp, and in my code, I must call the R function "optim" from C++. I referred to many examples, but there is still a mistake: "static assertion failed: cannot convert type to SEXP". Here is my code, and the problem is the last function:</p>

<pre><code>#include &lt;RcppArmadillo.h&gt;

using namespace Rcpp;
using namespace RcppArmadillo;
using namespace arma;
using namespace std;
// [[Rcpp::depends(RcppArmadillo)]]

// [[Rcpp::plugins(cpp11)]]

// [[Rcpp::export]]
double fr(arma::colvec x){
  double result = 100 * (x(2) - x(1) * x(1)) * (x(2) - x(1) * x(1)) + (1 -     x(1)) * (1 - x(1));
  return result;  
} 


typedef double (*funcPtr)(arma::colvec x);

// [[Rcpp::export]]
XPtr&lt;funcPtr&gt; putFunPtrInXPtr(){
  return(XPtr&lt;funcPtr&gt;(new funcPtr(&amp;fr)));
}


// [[Rcpp::export]]
arma::colvec callOptimFun(SEXP x) {

  RNGScope scope;

  Rcpp::Environment stats("package:stats");
  Rcpp::Function optim = stats["optim"];
  XPtr&lt;funcPtr&gt; xpfun = putFunPtrInXPtr();
  funcPtr fun = *xpfun;
  Rcpp::List y = optim(x, fun);
  arma::colvec r = y["par"];
  return r; 
}
</code></pre>

<p>Unfortunately, I have tried lots of methods for my last function, and all methods have the same error. These are my tries:
1.</p>

<pre><code>// [[Rcpp::export]]
Rcpp::List callOptimFun(arma::colvec x) {

  \\....
  Rcpp::List y = optim(x, fun);
  return y; 
}
</code></pre>

<p>2.</p>

<pre><code>// [[Rcpp::export]]
Rcpp::List callOptimFun(arma::colvec x) {

  \\....
  Rcpp::List y = optim(x, fun);
  return y; 
}
</code></pre>

<p>3.</p>

<pre><code>// [[Rcpp::export]]
Rcpp::List callOptimFun(SEXP x) {

  \\....
  Rcpp::List y = optim(x, fun);
  return y; 
}
</code></pre>

<p>I am not familiar with C++. What may be the problem? Thanks!</p>

        </details>
      </div>
    </div>

  </div>

</article> <article class="qa" id="qa-27371543">

  <div class="question">

    <div class="stats">
      <div class="votes">
        <span class="score">3</span>
        <div class="viewcount">votes</div>
      </div>
      <div class="views">
        <span class="score">487</span>
        <div class="viewcount">views</div>
      </div>
    </div>

    <div class="content">
      <div class="title">
        <h3>how many vectors can be added in DataFrame::create( vec1, vec2 ... )?</h3>
        <a href="https://stackoverflow.com/questions/27371543/how-many-vectors-can-be-added-in-dataframecreate-vec1-vec2" target="_blank">[see original]</a>
      </div>
      <div class="tags"><span>rcpp</span></div>
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/1033422/chris-snow" target="_blank"><img src="https://i.stack.imgur.com/I6uGA.png?s=256&g=1" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/1033422/chris-snow" target="_blank">Chris Snow</a>
        asked Dec 09 '14 at 04:40
      </div>
      <div class="body">
        <details>
          <summary>Click to expand question</summary>
          <p>I am creating a DataFrame to hold a parsed haproxy http log files which has quite a few fields (25+).</p>

<p>If I add more than 20 vectors (one for each field), I get the compilation error:</p>

<pre><code>no matching function call to 'create'
</code></pre>

<p>The create method:</p>

<pre class="lang-cpp prettyprint-override"><code>    return DataFrame::create(
      _["clientIp"]     = clientIp,
      _["clientPort"]   = clientPort,
      _["acceptDate"]   = acceptDate,
      _["frontendName"] = frontendName,
      _["backendName"]  = backendName,
      _["serverName"]   = serverName,
      _["tq"]           = tq,
      _["tw"]           = tw,
      _["tc"]           = tc,
      _["tr"]           = tr,
      _["tt"]           = tt,
      _["status_code"]  = statusCode,
      _["bytes_read"]   = bytesRead,

#if CAPTURED_REQUEST_COOKIE_FIELD == 1
      _["capturedRequestCookie"]   = capturedRequestCookie,
#endif     

#if CAPTURED_REQUEST_COOKIE_FIELD == 1
      _["capturedResponseCookie"]   = capturedResponseCookie,
#endif    

      _["terminationState"] = terminationState,
      _["actconn"]          = actconn,
      _["feconn"]           = feconn,
      _["beconn"]           = beconn,
      _["srv_conn"]         = srvConn,
      _["retries"]          = retries,
      _["serverQueue"]      = serverQueue,
      _["backendQueue"]     = backendQueue 
    );
</code></pre>

<p><strong>Questions</strong>:</p>

<ol>
<li>Have I hit a hard limit?</li>
<li>Is there a workaround to allow me to add more than 20 vectors to a data frame?</li>
</ol>

        </details>
      </div>
    </div>

  </div>

  <div class="answer">

    <div class="stats">
      <div class="votes answer-accepted-TRUE">
        <span class="score">6</span>
        <div class="viewcount">votes</div>
      </div>
    </div>

    <div class="content">
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/1342082/kevin-ushey" target="_blank"><img src="https://www.gravatar.com/avatar/1ef12d2cf78f28d7a1e76c8fc60978c8?s=256&d=identicon&r=PG" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/1342082/kevin-ushey" target="_blank">Kevin Ushey</a>
        replied Dec 09 '14 at 05:03
      </div>
      <div class="body">
        <details>
          <summary>Click to expand answer</summary>
          <p>I am creating a DataFrame to hold a parsed haproxy http log files which has quite a few fields (25+).</p>

<p>If I add more than 20 vectors (one for each field), I get the compilation error:</p>

<pre><code>no matching function call to 'create'
</code></pre>

<p>The create method:</p>

<pre class="lang-cpp prettyprint-override"><code>    return DataFrame::create(
      _["clientIp"]     = clientIp,
      _["clientPort"]   = clientPort,
      _["acceptDate"]   = acceptDate,
      _["frontendName"] = frontendName,
      _["backendName"]  = backendName,
      _["serverName"]   = serverName,
      _["tq"]           = tq,
      _["tw"]           = tw,
      _["tc"]           = tc,
      _["tr"]           = tr,
      _["tt"]           = tt,
      _["status_code"]  = statusCode,
      _["bytes_read"]   = bytesRead,

#if CAPTURED_REQUEST_COOKIE_FIELD == 1
      _["capturedRequestCookie"]   = capturedRequestCookie,
#endif     

#if CAPTURED_REQUEST_COOKIE_FIELD == 1
      _["capturedResponseCookie"]   = capturedResponseCookie,
#endif    

      _["terminationState"] = terminationState,
      _["actconn"]          = actconn,
      _["feconn"]           = feconn,
      _["beconn"]           = beconn,
      _["srv_conn"]         = srvConn,
      _["retries"]          = retries,
      _["serverQueue"]      = serverQueue,
      _["backendQueue"]     = backendQueue 
    );
</code></pre>

<p><strong>Questions</strong>:</p>

<ol>
<li>Have I hit a hard limit?</li>
<li>Is there a workaround to allow me to add more than 20 vectors to a data frame?</li>
</ol>

        </details>
      </div>
    </div>

  </div>

</article> <article class="qa" id="qa-38518387">

  <div class="question">

    <div class="stats">
      <div class="votes">
        <span class="score">1</span>
        <div class="viewcount">votes</div>
      </div>
      <div class="views">
        <span class="score">1.4k</span>
        <div class="viewcount">views</div>
      </div>
    </div>

    <div class="content">
      <div class="title">
        <h3>Using Rcpp functions inside of R&#39;s par*apply functions from the parallel package</h3>
        <a href="https://stackoverflow.com/questions/38518387/using-rcpp-functions-inside-of-rs-parapply-functions-from-the-parallel-package" target="_blank">[see original]</a>
      </div>
      <div class="tags"><span>r</span><span>parallel-processing</span><span>rcpp</span></div>
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/6610205/scott-white" target="_blank"><img src="https://www.gravatar.com/avatar/b2374ecc343f7e9e98bf0180db487083?s=256&d=identicon&r=PG&f=1" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/6610205/scott-white" target="_blank">Scott White</a>
        asked Jul 22 '16 at 04:50
      </div>
      <div class="body">
        <details>
          <summary>Click to expand question</summary>
          <p>I'm trying to understand what is happening behind the <code>Rcpp::sourceCpp()</code> call on a parallelized environment. Recently, this was partially addressed in the question: <a href="https://stackoverflow.com/questions/25606733/using-rcpp-function-in-parlapply-on-windows/25606950">Using Rcpp function in parLapply on Windows</a>.</p>

<p>Within this post, Dirk said,</p>

<blockquote>
  <p>"You need to run the sourceCpp() call in each spawned process, or else get them your code."</p>
</blockquote>

<p>This was in response to questioner's use of distributing the <em>Rcpp</em> function to the worker processes. The questioner was sending the <em>Rcpp</em> function via:</p>

<pre><code>clusterExport(cl = cl, varlist = "payoff")
</code></pre>

<p>I'm confused as to why this doesn't work. My thoughts are that this was what the objective of the <code>clusterExport()</code> is for.</p>

        </details>
      </div>
    </div>

  </div>

  <div class="answer">

    <div class="stats">
      <div class="votes answer-accepted-TRUE">
        <span class="score">5</span>
        <div class="viewcount">votes</div>
      </div>
    </div>

    <div class="content">
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/1345455/coatless" target="_blank"><img src="https://i.stack.imgur.com/DrBTs.jpg?s=256&g=1" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/1345455/coatless" target="_blank">coatless</a>
        replied Jul 22 '16 at 05:11
      </div>
      <div class="body">
        <details>
          <summary>Click to expand answer</summary>
          <p>I'm trying to understand what is happening behind the <code>Rcpp::sourceCpp()</code> call on a parallelized environment. Recently, this was partially addressed in the question: <a href="https://stackoverflow.com/questions/25606733/using-rcpp-function-in-parlapply-on-windows/25606950">Using Rcpp function in parLapply on Windows</a>.</p>

<p>Within this post, Dirk said,</p>

<blockquote>
  <p>"You need to run the sourceCpp() call in each spawned process, or else get them your code."</p>
</blockquote>

<p>This was in response to questioner's use of distributing the <em>Rcpp</em> function to the worker processes. The questioner was sending the <em>Rcpp</em> function via:</p>

<pre><code>clusterExport(cl = cl, varlist = "payoff")
</code></pre>

<p>I'm confused as to why this doesn't work. My thoughts are that this was what the objective of the <code>clusterExport()</code> is for.</p>

        </details>
      </div>
    </div>

  </div>

</article> <article class="qa" id="qa-3088650">

  <div class="question">

    <div class="stats">
      <div class="votes">
        <span class="score">35</span>
        <div class="viewcount">votes</div>
      </div>
      <div class="views">
        <span class="score">18.7k</span>
        <div class="viewcount">views</div>
      </div>
    </div>

    <div class="content">
      <div class="title">
        <h3>How do I create a list of vectors in Rcpp?</h3>
        <a href="https://stackoverflow.com/questions/3088650/how-do-i-create-a-list-of-vectors-in-rcpp" target="_blank">[see original]</a>
      </div>
      <div class="tags"><span>r</span><span>rcpp</span></div>
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/158065/jonathan-chang" target="_blank"><img src="https://www.gravatar.com/avatar/dbacb97cf5af766cdd6362323886b29e?s=256&d=identicon&r=PG" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/158065/jonathan-chang" target="_blank">Jonathan Chang</a>
        asked Jun 21 '10 at 21:30
      </div>
      <div class="body">
        <details>
          <summary>Click to expand question</summary>
          <p>I'm writing an Rcpp module an would like to return as one element of the RcppResultSet list a list whose elements are vectors.   E.g., <code>.Call("myfunc")$foo</code> should be something like: </p>

<pre><code>[[1]]
[1] 1

[[2]]
[1] 1 1

[[3]]
[1] 1 1 1
</code></pre>

<p>(the exact numbers are not important here).  The issue is that I don't know the right Rcpp way of doing this.  I tried passing a <code>vector&lt;vector&lt;int&gt; &gt;</code> but this constructs a matrix by silently taking the length of the first vector as the width (even if the matrix is ragged!).  I've tried constructing an <code>RcppList</code> but have a hard time casting various objects (like <code>RcppVector</code>) safely into <code>SEXP</code>s.</p>

<p>Anyone have tips on best practices for dealing with complicated structures such as lists of vectors in Rcpp?</p>

        </details>
      </div>
    </div>

  </div>

  <div class="answer">

    <div class="stats">
      <div class="votes answer-accepted-TRUE">
        <span class="score">50</span>
        <div class="viewcount">votes</div>
      </div>
    </div>

    <div class="content">
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/143305/dirk-eddelbuettel" target="_blank"><img src="https://www.gravatar.com/avatar/4e96ca7ae02c37e7d940d17997d780e5?s=256&d=identicon&r=PG" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/143305/dirk-eddelbuettel" target="_blank">Dirk Eddelbuettel</a>
        replied Jun 21 '10 at 21:50
      </div>
      <div class="body">
        <details>
          <summary>Click to expand answer</summary>
          <p>I'm writing an Rcpp module an would like to return as one element of the RcppResultSet list a list whose elements are vectors.   E.g., <code>.Call("myfunc")$foo</code> should be something like: </p>

<pre><code>[[1]]
[1] 1

[[2]]
[1] 1 1

[[3]]
[1] 1 1 1
</code></pre>

<p>(the exact numbers are not important here).  The issue is that I don't know the right Rcpp way of doing this.  I tried passing a <code>vector&lt;vector&lt;int&gt; &gt;</code> but this constructs a matrix by silently taking the length of the first vector as the width (even if the matrix is ragged!).  I've tried constructing an <code>RcppList</code> but have a hard time casting various objects (like <code>RcppVector</code>) safely into <code>SEXP</code>s.</p>

<p>Anyone have tips on best practices for dealing with complicated structures such as lists of vectors in Rcpp?</p>

        </details>
      </div>
    </div>

  </div>

</article> <article class="qa" id="qa-41602024">

  <div class="question">

    <div class="stats">
      <div class="votes">
        <span class="score">18</span>
        <div class="viewcount">votes</div>
      </div>
      <div class="views">
        <span class="score">7.5k</span>
        <div class="viewcount">views</div>
      </div>
    </div>

    <div class="content">
      <div class="title">
        <h3>Should I prefer Rcpp::NumericVector over std::vector?</h3>
        <a href="https://stackoverflow.com/questions/41602024/should-i-prefer-rcppnumericvector-over-stdvector" target="_blank">[see original]</a>
      </div>
      <div class="tags"><span>c++</span><span>rcpp</span></div>
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/3986320/tim" target="_blank"><img src="https://i.stack.imgur.com/YB28g.jpg?s=256&g=1" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/3986320/tim" target="_blank">Tim</a>
        asked Jan 11 '17 at 22:38
      </div>
      <div class="body">
        <details>
          <summary>Click to expand question</summary>
          <p>Is there any reason why I should prefer <code>Rcpp::NumericVector</code> over <code>std::vector&lt;double&gt;</code>?</p>

<p>For example, the two functions below</p>

<pre><code>// [[Rcpp::export]]
Rcpp::NumericVector foo(const Rcpp::NumericVector&amp; x) {
  Rcpp::NumericVector tmp(x.length());
  for (int i = 0; i &lt; x.length(); i++)
    tmp[i] = x[i] + 1.0;
  return tmp;
}

// [[Rcpp::export]]
std::vector&lt;double&gt; bar(const std::vector&lt;double&gt;&amp; x) {
  std::vector&lt;double&gt; tmp(x.size());
  for (int i = 0; i &lt; x.size(); i++)
    tmp[i] = x[i] + 1.0;
  return tmp;
}
</code></pre>

<p>Are equivalent when considering their working and benchmarked performance. I understand that Rcpp offers sugar and vectorized operations, but if it is only about taking R's vector as input and returning vector as output, then would there be any difference which one of those I use? Can using <code>std::vector&lt;double&gt;</code> lead to any possible problems when interacting with R?</p>

        </details>
      </div>
    </div>

  </div>

  <div class="answer">

    <div class="stats">
      <div class="votes answer-accepted-TRUE">
        <span class="score">27</span>
        <div class="viewcount">votes</div>
      </div>
    </div>

    <div class="content">
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/1345455/coatless" target="_blank"><img src="https://i.stack.imgur.com/DrBTs.jpg?s=256&g=1" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/1345455/coatless" target="_blank">coatless</a>
        replied Jan 11 '17 at 22:59
      </div>
      <div class="body">
        <details>
          <summary>Click to expand answer</summary>
          <p>Is there any reason why I should prefer <code>Rcpp::NumericVector</code> over <code>std::vector&lt;double&gt;</code>?</p>

<p>For example, the two functions below</p>

<pre><code>// [[Rcpp::export]]
Rcpp::NumericVector foo(const Rcpp::NumericVector&amp; x) {
  Rcpp::NumericVector tmp(x.length());
  for (int i = 0; i &lt; x.length(); i++)
    tmp[i] = x[i] + 1.0;
  return tmp;
}

// [[Rcpp::export]]
std::vector&lt;double&gt; bar(const std::vector&lt;double&gt;&amp; x) {
  std::vector&lt;double&gt; tmp(x.size());
  for (int i = 0; i &lt; x.size(); i++)
    tmp[i] = x[i] + 1.0;
  return tmp;
}
</code></pre>

<p>Are equivalent when considering their working and benchmarked performance. I understand that Rcpp offers sugar and vectorized operations, but if it is only about taking R's vector as input and returning vector as output, then would there be any difference which one of those I use? Can using <code>std::vector&lt;double&gt;</code> lead to any possible problems when interacting with R?</p>

        </details>
      </div>
    </div>

  </div>

</article> <article class="qa" id="qa-48363076">

  <div class="question">

    <div class="stats">
      <div class="votes">
        <span class="score">4</span>
        <div class="viewcount">votes</div>
      </div>
      <div class="views">
        <span class="score">1.3k</span>
        <div class="viewcount">views</div>
      </div>
    </div>

    <div class="content">
      <div class="title">
        <h3>Declare a variable as a reference in Rcpp</h3>
        <a href="https://stackoverflow.com/questions/48363076/declare-a-variable-as-a-reference-in-rcpp" target="_blank">[see original]</a>
      </div>
      <div class="tags"><span>rcpp</span><span>rcpp11</span></div>
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/2978524/user2978524" target="_blank"><img src="https://www.gravatar.com/avatar/?s=256&d=identicon&r=PG&f=1" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/2978524/user2978524" target="_blank">user2978524</a>
        asked Jan 21 '18 at 02:22
      </div>
      <div class="body">
        <details>
          <summary>Click to expand question</summary>
          <p>In C++, we can declare a variable as a reference.</p>

<pre><code>int a = 10;
int&amp; b = a;
</code></pre>

<p>If we set <code>b=15</code>, <code>a</code> also changes.</p>

<p>I want to do the similar thing in Rcpp. </p>

<pre><code>List X = obj_from_R["X"];
IntegerVector x_i = X[index];
x_i = value;
</code></pre>

<p>I want to update an object from R called <code>X</code> by inserting a value to one of its vector. The code above did not work, so I tried this:</p>

<pre><code>IntegerVector&amp; x_i = X[index];
</code></pre>

<p>and received an error.</p>

<pre><code>error: non-const lvalue reference to type 'IntegerVector'
      (aka 'Vector&lt;13&gt;') cannot bind to a temporary of type 'Proxy' (aka 'generic_proxy&lt;19&gt;')
</code></pre>

        </details>
      </div>
    </div>

  </div>

  <div class="answer">

    <div class="stats">
      <div class="votes answer-accepted-FALSE">
        <span class="score">12</span>
        <div class="viewcount">votes</div>
      </div>
    </div>

    <div class="content">
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/1345455/coatless" target="_blank"><img src="https://i.stack.imgur.com/DrBTs.jpg?s=256&g=1" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/1345455/coatless" target="_blank">coatless</a>
        replied Jan 21 '18 at 02:51
      </div>
      <div class="body">
        <details>
          <summary>Click to expand answer</summary>
          <p>In C++, we can declare a variable as a reference.</p>

<pre><code>int a = 10;
int&amp; b = a;
</code></pre>

<p>If we set <code>b=15</code>, <code>a</code> also changes.</p>

<p>I want to do the similar thing in Rcpp. </p>

<pre><code>List X = obj_from_R["X"];
IntegerVector x_i = X[index];
x_i = value;
</code></pre>

<p>I want to update an object from R called <code>X</code> by inserting a value to one of its vector. The code above did not work, so I tried this:</p>

<pre><code>IntegerVector&amp; x_i = X[index];
</code></pre>

<p>and received an error.</p>

<pre><code>error: non-const lvalue reference to type 'IntegerVector'
      (aka 'Vector&lt;13&gt;') cannot bind to a temporary of type 'Proxy' (aka 'generic_proxy&lt;19&gt;')
</code></pre>

        </details>
      </div>
    </div>

  </div>

</article> <article class="qa" id="qa-37060211">

  <div class="question">

    <div class="stats">
      <div class="votes">
        <span class="score">12</span>
        <div class="viewcount">votes</div>
      </div>
      <div class="views">
        <span class="score">2.8k</span>
        <div class="viewcount">views</div>
      </div>
    </div>

    <div class="content">
      <div class="title">
        <h3>efficiently locf by groups in a single R data.table</h3>
        <a href="https://stackoverflow.com/questions/37060211/efficiently-locf-by-groups-in-a-single-r-data-table" target="_blank">[see original]</a>
      </div>
      <div class="tags"><span>r</span><span>dataframe</span><span>data.table</span><span>dplyr</span><span>rcpp</span></div>
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/280708/carl-anderson" target="_blank"><img src="https://i.stack.imgur.com/NS0O4.png?s=256&g=1" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/280708/carl-anderson" target="_blank">carl.anderson</a>
        asked May 05 '16 at 20:59
      </div>
      <div class="body">
        <details>
          <summary>Click to expand question</summary>
          <p>I have a large, wide <code>data.table</code> (20m rows) keyed by a person ID but with lots of columns (~150) that have lots of null values.  Each column is a recorded state / attribute that I wish to carry forward for each person.  Each person may have anywhere from 10 to 10,000 observations and there are about 500,000 people in the set.  Values from one person can not 'bleed' into the following person, so my solution must respect the person ID column and group appropriately.</p>

<p>For demonstration purposes - here's a very small sample input:</p>

<pre><code>DT = data.table(
  id=c(1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3),
  aa=c("A", NA, "B", "C", NA, NA, "D", "E", "F", NA, NA, NA),
  bb=c(NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA),
  cc=c(1, NA, NA, NA, NA, 4, NA, 5, 6, NA, 7, NA)
)
</code></pre>

<p>It looks like this:</p>

<pre><code>    id aa bb cc
 1:  1  A NA  1
 2:  1 NA NA NA
 3:  1  B NA NA
 4:  1  C NA NA
 5:  2 NA NA NA
 6:  2 NA NA  4
 7:  2  D NA NA
 8:  2  E NA  5
 9:  3  F NA  6
10:  3 NA NA NA
11:  3 NA NA  7
12:  3 NA NA NA
</code></pre>

<p>My expected output looks like this:</p>

<pre><code>    id aa bb cc
 1:  1  A NA  1
 2:  1  A NA  1
 3:  1  B NA  1
 4:  1  C NA  1
 5:  2 NA NA NA
 6:  2 NA NA  4
 7:  2  D NA  4
 8:  2  E NA  5
 9:  3  F NA  6
10:  3  F NA  6
11:  3  F NA  7
12:  3  F NA  7
</code></pre>

<p>I've found a <code>data.table</code> solution that works, but it's terribly slow on my large data sets:</p>

<pre><code>DT[, na.locf(.SD, na.rm=FALSE), by=id]
</code></pre>

<p>I've found equivalent solutions using dplyr that are equally slow.</p>

<pre><code>GRP = DT %&gt;% group_by(id)
data.table(GRP %&gt;% mutate_each(funs(blah=na.locf(., na.rm=FALSE))))
</code></pre>

<p>I was hopeful that I could come up with a rolling 'self' join using the <code>data.table</code> functionality, but I just can't seem to get it right (I suspect I would need to use <code>.N</code> but I just haven't figured it out).</p>

<p>At this point I'm thinking I'll have to write something in Rcpp to efficiently apply the grouped locf.  </p>

<p>I'm new to R, but I'm not new to C++ - so I'm confident I can do it.  I just feel like there should be an efficient way to do this in R using <code>data.table</code>.</p>

        </details>
      </div>
    </div>

  </div>

  <div class="answer">

    <div class="stats">
      <div class="votes answer-accepted-TRUE">
        <span class="score">24</span>
        <div class="viewcount">votes</div>
      </div>
    </div>

    <div class="content">
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/2414948/alexis-laz" target="_blank"><img src="https://www.gravatar.com/avatar/f4a4db8db8724f88b7de4340a42778a5?s=256&d=identicon&r=PG" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/2414948/alexis-laz" target="_blank">alexis_laz</a>
        replied May 06 '16 at 09:16
      </div>
      <div class="body">
        <details>
          <summary>Click to expand answer</summary>
          <p>I have a large, wide <code>data.table</code> (20m rows) keyed by a person ID but with lots of columns (~150) that have lots of null values.  Each column is a recorded state / attribute that I wish to carry forward for each person.  Each person may have anywhere from 10 to 10,000 observations and there are about 500,000 people in the set.  Values from one person can not 'bleed' into the following person, so my solution must respect the person ID column and group appropriately.</p>

<p>For demonstration purposes - here's a very small sample input:</p>

<pre><code>DT = data.table(
  id=c(1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3),
  aa=c("A", NA, "B", "C", NA, NA, "D", "E", "F", NA, NA, NA),
  bb=c(NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA),
  cc=c(1, NA, NA, NA, NA, 4, NA, 5, 6, NA, 7, NA)
)
</code></pre>

<p>It looks like this:</p>

<pre><code>    id aa bb cc
 1:  1  A NA  1
 2:  1 NA NA NA
 3:  1  B NA NA
 4:  1  C NA NA
 5:  2 NA NA NA
 6:  2 NA NA  4
 7:  2  D NA NA
 8:  2  E NA  5
 9:  3  F NA  6
10:  3 NA NA NA
11:  3 NA NA  7
12:  3 NA NA NA
</code></pre>

<p>My expected output looks like this:</p>

<pre><code>    id aa bb cc
 1:  1  A NA  1
 2:  1  A NA  1
 3:  1  B NA  1
 4:  1  C NA  1
 5:  2 NA NA NA
 6:  2 NA NA  4
 7:  2  D NA  4
 8:  2  E NA  5
 9:  3  F NA  6
10:  3  F NA  6
11:  3  F NA  7
12:  3  F NA  7
</code></pre>

<p>I've found a <code>data.table</code> solution that works, but it's terribly slow on my large data sets:</p>

<pre><code>DT[, na.locf(.SD, na.rm=FALSE), by=id]
</code></pre>

<p>I've found equivalent solutions using dplyr that are equally slow.</p>

<pre><code>GRP = DT %&gt;% group_by(id)
data.table(GRP %&gt;% mutate_each(funs(blah=na.locf(., na.rm=FALSE))))
</code></pre>

<p>I was hopeful that I could come up with a rolling 'self' join using the <code>data.table</code> functionality, but I just can't seem to get it right (I suspect I would need to use <code>.N</code> but I just haven't figured it out).</p>

<p>At this point I'm thinking I'll have to write something in Rcpp to efficiently apply the grouped locf.  </p>

<p>I'm new to R, but I'm not new to C++ - so I'm confident I can do it.  I just feel like there should be an efficient way to do this in R using <code>data.table</code>.</p>

        </details>
      </div>
    </div>

  </div>

</article> <article class="qa" id="qa-30628333">

  <div class="question">

    <div class="stats">
      <div class="votes">
        <span class="score">12</span>
        <div class="viewcount">votes</div>
      </div>
      <div class="views">
        <span class="score">3k</span>
        <div class="viewcount">views</div>
      </div>
    </div>

    <div class="content">
      <div class="title">
        <h3>Building a tiny R package with CUDA and Rcpp</h3>
        <a href="https://stackoverflow.com/questions/30628333/building-a-tiny-r-package-with-cuda-and-rcpp" target="_blank">[see original]</a>
      </div>
      <div class="tags"><span>r</span><span>cuda</span><span>rcpp</span></div>
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/3704549/landau" target="_blank"><img src="https://www.gravatar.com/avatar/04621407e8a36881c78859daf6f14d2f?s=256&d=identicon&r=PG" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/3704549/landau" target="_blank">landau</a>
        asked Jun 03 '15 at 18:52
      </div>
      <div class="body">
        <details>
          <summary>Click to expand question</summary>
          <p>I'm working on a <a href="https://github.com/wlandau/rcppcuda" rel="noreferrer">tiny R package</a> that uses CUDA and Rcpp, adapted from the output of <code>Rcpp.package.skeleton()</code>. I will first describe what happens on the master branch for the commit entitled "fixed namespace". The package installs successfully if I forget CUDA (i.e., if I remove the src/Makefile, change src/rcppcuda.cu to src/rcppcuda.cpp, and comment out the code that defines and calls kernels). But as is, the compilation fails.</p>

<p>I also would like to know how to compile with a Makevars or Makevars.in instead of a Makefile, and in general, try to make this as platform independent as is realistic. I've read about Makevars in the <a href="http://cran.r-project.org/doc/manuals/r-release/R-exts.html" rel="noreferrer">R extensions manual</a>, but I still haven't been able to make it work.</p>

<p>Some of you may suggest <a href="http://www.rcuda.net/" rel="noreferrer"><code>rCUDA</code></a>, but what I'm really after here is improving a big package I've already been developing for some time, and I'm not sure that switching is worth starting again from scratch.</p>

<p>Anyway, here's what happens when I do an <code>R CMD build</code> and <code>R CMD INSTALL</code> on <a href="https://github.com/wlandau/rcppcuda" rel="noreferrer">this one</a> (master branch, commit entitled "fixed namespace").</p>

<pre><code>* installing to library ‘/home/landau/.R/library’
* installing *source* package ‘rcppcuda’ ...
** libs
** arch - 
/usr/local/cuda/bin/nvcc -c rcppcuda.cu -o rcppcuda.o --shared -Xcompiler "-fPIC" -gencode arch=compute_20,code=sm_20 -gencode arch=compute_30,code=sm_30 -gencode arch=compute_35,code=sm_35 -I/apps/R-3.2.0/include -I/usr/local/cuda/include 
rcppcuda.cu:1:18: error: Rcpp.h: No such file or directory
make: *** [rcppcuda.o] Error 1
ERROR: compilation failed for package ‘rcppcuda’
* removing ‘/home/landau/.R/library/rcppcuda’
</code></pre>

<p>...which is strange, because I do include Rcpp.h, and Rcpp is installed.</p>

<pre><code>$ R

R version 3.2.0 (2015-04-16) -- "Full of Ingredients"
Copyright (C) 2015 The R Foundation for Statistical Computing
Platform: x86_64-unknown-linux-gnu (64-bit)
</code></pre>

<p>...</p>

<pre><code>&gt; library(Rcpp)
&gt; sessionInfo()
R version 3.2.0 (2015-04-16)
Platform: x86_64-unknown-linux-gnu (64-bit)
Running under: CentOS release 6.6 (Final)

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
 [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
 [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   
 [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 
 [9] LC_ADDRESS=C               LC_TELEPHONE=C            
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] Rcpp_0.11.6
&gt; 
</code></pre>

<p>I'm using CentOS,</p>

<pre><code>$ cat /etc/*-release
CentOS release 6.6 (Final)
LSB_VERSION=base-4.0-amd64:base-4.0-noarch:core-4.0-amd64:core-4.0-noarch:graphics-4.0-amd64:graphics-4.0-noarch:printing-4.0-amd64:printing-4.0-noarch
CentOS release 6.6 (Final)
CentOS release 6.6 (Final)
</code></pre>

<p>CUDA version 6,</p>

<pre><code>$ nvcc --version
nvcc: NVIDIA (R) Cuda compiler driver
Copyright (c) 2005-2013 NVIDIA Corporation
Built on Thu_Mar_13_11:58:58_PDT_2014
Cuda compilation tools, release 6.0, V6.0.1
</code></pre>

<p>and I have access to 4 GPUs of the same make and model.</p>

<pre><code>$ /usr/local/cuda/samples/bin/x86_64/linux/release/deviceQuery 
/usr/local/cuda/samples/bin/x86_64/linux/release/deviceQuery Starting...

 CUDA Device Query (Runtime API) version (CUDART static linking)

Detected 4 CUDA Capable device(s)

Device 0: "Tesla M2070"
  CUDA Driver Version / Runtime Version          6.0 / 6.0
  CUDA Capability Major/Minor version number:    2.0
  Total amount of global memory:                 5375 MBytes (5636554752 bytes)
  (14) Multiprocessors, ( 32) CUDA Cores/MP:     448 CUDA Cores
  GPU Clock rate:                                1147 MHz (1.15 GHz)
  Memory Clock rate:                             1566 Mhz
  Memory Bus Width:                              384-bit
  L2 Cache Size:                                 786432 bytes
  Maximum Texture Dimension Size (x,y,z)         1D=(65536), 2D=(65536, 65535), 3D=(2048, 2048, 2048)
  Maximum Layered 1D Texture Size, (num) layers  1D=(16384), 2048 layers
  Maximum Layered 2D Texture Size, (num) layers  2D=(16384, 16384), 2048 layers
  Total amount of constant memory:               65536 bytes
  Total amount of shared memory per block:       49152 bytes
  Total number of registers available per block: 32768
  Warp size:                                     32
  Maximum number of threads per multiprocessor:  1536
  Maximum number of threads per block:           1024
  Max dimension size of a thread block (x,y,z): (1024, 1024, 64)
  Max dimension size of a grid size    (x,y,z): (65535, 65535, 65535)
  Maximum memory pitch:                          2147483647 bytes
  Texture alignment:                             512 bytes
  Concurrent copy and kernel execution:          Yes with 2 copy engine(s)
  Run time limit on kernels:                     No
  Integrated GPU sharing Host Memory:            No
  Support host page-locked memory mapping:       Yes
  Alignment requirement for Surfaces:            Yes
  Device has ECC support:                        Enabled
  Device supports Unified Addressing (UVA):      Yes
  Device PCI Bus ID / PCI location ID:           11 / 0
  Compute Mode:
     &lt; Default (multiple host threads can use ::cudaSetDevice() with device simultaneously) &gt;
</code></pre>

<p>...</p>

<pre><code>&gt; Peer access from Tesla M2070 (GPU0) -&gt; Tesla M2070 (GPU1) : Yes
&gt; Peer access from Tesla M2070 (GPU0) -&gt; Tesla M2070 (GPU2) : Yes
&gt; Peer access from Tesla M2070 (GPU0) -&gt; Tesla M2070 (GPU3) : Yes
&gt; Peer access from Tesla M2070 (GPU1) -&gt; Tesla M2070 (GPU1) : No
&gt; Peer access from Tesla M2070 (GPU1) -&gt; Tesla M2070 (GPU2) : Yes
&gt; Peer access from Tesla M2070 (GPU1) -&gt; Tesla M2070 (GPU3) : Yes
&gt; Peer access from Tesla M2070 (GPU2) -&gt; Tesla M2070 (GPU1) : Yes
&gt; Peer access from Tesla M2070 (GPU2) -&gt; Tesla M2070 (GPU2) : No
&gt; Peer access from Tesla M2070 (GPU2) -&gt; Tesla M2070 (GPU3) : Yes
&gt; Peer access from Tesla M2070 (GPU1) -&gt; Tesla M2070 (GPU0) : Yes
&gt; Peer access from Tesla M2070 (GPU1) -&gt; Tesla M2070 (GPU1) : No
&gt; Peer access from Tesla M2070 (GPU1) -&gt; Tesla M2070 (GPU2) : Yes
&gt; Peer access from Tesla M2070 (GPU2) -&gt; Tesla M2070 (GPU0) : Yes
&gt; Peer access from Tesla M2070 (GPU2) -&gt; Tesla M2070 (GPU1) : Yes
&gt; Peer access from Tesla M2070 (GPU2) -&gt; Tesla M2070 (GPU2) : No
&gt; Peer access from Tesla M2070 (GPU3) -&gt; Tesla M2070 (GPU0) : Yes
&gt; Peer access from Tesla M2070 (GPU3) -&gt; Tesla M2070 (GPU1) : Yes
&gt; Peer access from Tesla M2070 (GPU3) -&gt; Tesla M2070 (GPU2) : Yes

deviceQuery, CUDA Driver = CUDART, CUDA Driver Version = 6.0, CUDA Runtime Version = 6.0, NumDevs = 4, Device0 = Tesla M2070, Device1 = Tesla M2070, Device2 = Tesla M2070, Device3 = Tesla M2070
Result = PASS
</code></pre>

<hr>

<p><strong>Edit: it compiles for any commit after "fixed namespace" on either branch, but there are still problems with combining Rcpp and CUDA</strong></p>

<p>To make the package compile, it turns out that I just needed to separate my C++ and CUDA code into separate <code>*.cpp</code> and <code>*.cu</code> files. However, when I try the "compiling cpp and cu separately" commit on the master branch, I get</p>

<pre><code>&gt; library(rcppcuda)
&gt; hello()
An object of class "MyClass"
Slot "x":
 [1]  1  2  3  4  5  6  7  8  9 10

Slot "y":
 [1]  1  2  3  4  5  6  7  8  9 10

Error in .Call("someCPPcode", r) : 
  "someCPPcode" not resolved from current namespace (rcppcuda)
&gt; 
</code></pre>

<p>The error goes away in the <code>withoutCUDA</code> branch in the commit entitled "adding branch withoutCUDA".</p>

<pre><code>&gt; library(rcppcuda)
&gt; hello()
An object of class "MyClass"
Slot "x":
 [1]  1  2  3  4  5  6  7  8  9 10

Slot "y":
 [1]  1  2  3  4  5  6  7  8  9 10

[1] "Object changed."
An object of class "MyClass"
Slot "x":
 [1] 500   2   3   4   5   6   7   8   9  10

Slot "y":
 [1]    1 1000    3    4    5    6    7    8    9   10

&gt; 
</code></pre>

<p>The only differences between the "compiling cpp and cu separately" commit on <code>master</code> and the "adding branch withoutCUDA" commit on <code>withoutCUDA</code> are</p>

<ul>
<li>The Makefile and someCUDAcode.cu are gone from <code>withoutCUDA</code>.</li>
<li>In <code>withoutCUDA</code>, all references to <code>someCUDAcode()</code> are gone from someCPPcode.cpp.</li>
</ul>

<p>Also, it would still be convenient be able to use CUDA and Rcpp in the same <code>*.cu</code> file. I would really like to know how to fix the "fixed namespace" commit on the master branch.</p>

        </details>
      </div>
    </div>

  </div>

  <div class="answer">

    <div class="stats">
      <div class="votes answer-accepted-TRUE">
        <span class="score">11</span>
        <div class="viewcount">votes</div>
      </div>
    </div>

    <div class="content">
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/3204250/cdeterman" target="_blank"><img src="https://www.gravatar.com/avatar/e6ad04bcae2e13bea6d5607c8a8425f8?s=256&d=identicon&r=PG&f=1" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/3204250/cdeterman" target="_blank">cdeterman</a>
        replied Jun 08 '15 at 14:20
      </div>
      <div class="body">
        <details>
          <summary>Click to expand answer</summary>
          <p>I'm working on a <a href="https://github.com/wlandau/rcppcuda" rel="noreferrer">tiny R package</a> that uses CUDA and Rcpp, adapted from the output of <code>Rcpp.package.skeleton()</code>. I will first describe what happens on the master branch for the commit entitled "fixed namespace". The package installs successfully if I forget CUDA (i.e., if I remove the src/Makefile, change src/rcppcuda.cu to src/rcppcuda.cpp, and comment out the code that defines and calls kernels). But as is, the compilation fails.</p>

<p>I also would like to know how to compile with a Makevars or Makevars.in instead of a Makefile, and in general, try to make this as platform independent as is realistic. I've read about Makevars in the <a href="http://cran.r-project.org/doc/manuals/r-release/R-exts.html" rel="noreferrer">R extensions manual</a>, but I still haven't been able to make it work.</p>

<p>Some of you may suggest <a href="http://www.rcuda.net/" rel="noreferrer"><code>rCUDA</code></a>, but what I'm really after here is improving a big package I've already been developing for some time, and I'm not sure that switching is worth starting again from scratch.</p>

<p>Anyway, here's what happens when I do an <code>R CMD build</code> and <code>R CMD INSTALL</code> on <a href="https://github.com/wlandau/rcppcuda" rel="noreferrer">this one</a> (master branch, commit entitled "fixed namespace").</p>

<pre><code>* installing to library ‘/home/landau/.R/library’
* installing *source* package ‘rcppcuda’ ...
** libs
** arch - 
/usr/local/cuda/bin/nvcc -c rcppcuda.cu -o rcppcuda.o --shared -Xcompiler "-fPIC" -gencode arch=compute_20,code=sm_20 -gencode arch=compute_30,code=sm_30 -gencode arch=compute_35,code=sm_35 -I/apps/R-3.2.0/include -I/usr/local/cuda/include 
rcppcuda.cu:1:18: error: Rcpp.h: No such file or directory
make: *** [rcppcuda.o] Error 1
ERROR: compilation failed for package ‘rcppcuda’
* removing ‘/home/landau/.R/library/rcppcuda’
</code></pre>

<p>...which is strange, because I do include Rcpp.h, and Rcpp is installed.</p>

<pre><code>$ R

R version 3.2.0 (2015-04-16) -- "Full of Ingredients"
Copyright (C) 2015 The R Foundation for Statistical Computing
Platform: x86_64-unknown-linux-gnu (64-bit)
</code></pre>

<p>...</p>

<pre><code>&gt; library(Rcpp)
&gt; sessionInfo()
R version 3.2.0 (2015-04-16)
Platform: x86_64-unknown-linux-gnu (64-bit)
Running under: CentOS release 6.6 (Final)

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
 [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
 [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   
 [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 
 [9] LC_ADDRESS=C               LC_TELEPHONE=C            
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] Rcpp_0.11.6
&gt; 
</code></pre>

<p>I'm using CentOS,</p>

<pre><code>$ cat /etc/*-release
CentOS release 6.6 (Final)
LSB_VERSION=base-4.0-amd64:base-4.0-noarch:core-4.0-amd64:core-4.0-noarch:graphics-4.0-amd64:graphics-4.0-noarch:printing-4.0-amd64:printing-4.0-noarch
CentOS release 6.6 (Final)
CentOS release 6.6 (Final)
</code></pre>

<p>CUDA version 6,</p>

<pre><code>$ nvcc --version
nvcc: NVIDIA (R) Cuda compiler driver
Copyright (c) 2005-2013 NVIDIA Corporation
Built on Thu_Mar_13_11:58:58_PDT_2014
Cuda compilation tools, release 6.0, V6.0.1
</code></pre>

<p>and I have access to 4 GPUs of the same make and model.</p>

<pre><code>$ /usr/local/cuda/samples/bin/x86_64/linux/release/deviceQuery 
/usr/local/cuda/samples/bin/x86_64/linux/release/deviceQuery Starting...

 CUDA Device Query (Runtime API) version (CUDART static linking)

Detected 4 CUDA Capable device(s)

Device 0: "Tesla M2070"
  CUDA Driver Version / Runtime Version          6.0 / 6.0
  CUDA Capability Major/Minor version number:    2.0
  Total amount of global memory:                 5375 MBytes (5636554752 bytes)
  (14) Multiprocessors, ( 32) CUDA Cores/MP:     448 CUDA Cores
  GPU Clock rate:                                1147 MHz (1.15 GHz)
  Memory Clock rate:                             1566 Mhz
  Memory Bus Width:                              384-bit
  L2 Cache Size:                                 786432 bytes
  Maximum Texture Dimension Size (x,y,z)         1D=(65536), 2D=(65536, 65535), 3D=(2048, 2048, 2048)
  Maximum Layered 1D Texture Size, (num) layers  1D=(16384), 2048 layers
  Maximum Layered 2D Texture Size, (num) layers  2D=(16384, 16384), 2048 layers
  Total amount of constant memory:               65536 bytes
  Total amount of shared memory per block:       49152 bytes
  Total number of registers available per block: 32768
  Warp size:                                     32
  Maximum number of threads per multiprocessor:  1536
  Maximum number of threads per block:           1024
  Max dimension size of a thread block (x,y,z): (1024, 1024, 64)
  Max dimension size of a grid size    (x,y,z): (65535, 65535, 65535)
  Maximum memory pitch:                          2147483647 bytes
  Texture alignment:                             512 bytes
  Concurrent copy and kernel execution:          Yes with 2 copy engine(s)
  Run time limit on kernels:                     No
  Integrated GPU sharing Host Memory:            No
  Support host page-locked memory mapping:       Yes
  Alignment requirement for Surfaces:            Yes
  Device has ECC support:                        Enabled
  Device supports Unified Addressing (UVA):      Yes
  Device PCI Bus ID / PCI location ID:           11 / 0
  Compute Mode:
     &lt; Default (multiple host threads can use ::cudaSetDevice() with device simultaneously) &gt;
</code></pre>

<p>...</p>

<pre><code>&gt; Peer access from Tesla M2070 (GPU0) -&gt; Tesla M2070 (GPU1) : Yes
&gt; Peer access from Tesla M2070 (GPU0) -&gt; Tesla M2070 (GPU2) : Yes
&gt; Peer access from Tesla M2070 (GPU0) -&gt; Tesla M2070 (GPU3) : Yes
&gt; Peer access from Tesla M2070 (GPU1) -&gt; Tesla M2070 (GPU1) : No
&gt; Peer access from Tesla M2070 (GPU1) -&gt; Tesla M2070 (GPU2) : Yes
&gt; Peer access from Tesla M2070 (GPU1) -&gt; Tesla M2070 (GPU3) : Yes
&gt; Peer access from Tesla M2070 (GPU2) -&gt; Tesla M2070 (GPU1) : Yes
&gt; Peer access from Tesla M2070 (GPU2) -&gt; Tesla M2070 (GPU2) : No
&gt; Peer access from Tesla M2070 (GPU2) -&gt; Tesla M2070 (GPU3) : Yes
&gt; Peer access from Tesla M2070 (GPU1) -&gt; Tesla M2070 (GPU0) : Yes
&gt; Peer access from Tesla M2070 (GPU1) -&gt; Tesla M2070 (GPU1) : No
&gt; Peer access from Tesla M2070 (GPU1) -&gt; Tesla M2070 (GPU2) : Yes
&gt; Peer access from Tesla M2070 (GPU2) -&gt; Tesla M2070 (GPU0) : Yes
&gt; Peer access from Tesla M2070 (GPU2) -&gt; Tesla M2070 (GPU1) : Yes
&gt; Peer access from Tesla M2070 (GPU2) -&gt; Tesla M2070 (GPU2) : No
&gt; Peer access from Tesla M2070 (GPU3) -&gt; Tesla M2070 (GPU0) : Yes
&gt; Peer access from Tesla M2070 (GPU3) -&gt; Tesla M2070 (GPU1) : Yes
&gt; Peer access from Tesla M2070 (GPU3) -&gt; Tesla M2070 (GPU2) : Yes

deviceQuery, CUDA Driver = CUDART, CUDA Driver Version = 6.0, CUDA Runtime Version = 6.0, NumDevs = 4, Device0 = Tesla M2070, Device1 = Tesla M2070, Device2 = Tesla M2070, Device3 = Tesla M2070
Result = PASS
</code></pre>

<hr>

<p><strong>Edit: it compiles for any commit after "fixed namespace" on either branch, but there are still problems with combining Rcpp and CUDA</strong></p>

<p>To make the package compile, it turns out that I just needed to separate my C++ and CUDA code into separate <code>*.cpp</code> and <code>*.cu</code> files. However, when I try the "compiling cpp and cu separately" commit on the master branch, I get</p>

<pre><code>&gt; library(rcppcuda)
&gt; hello()
An object of class "MyClass"
Slot "x":
 [1]  1  2  3  4  5  6  7  8  9 10

Slot "y":
 [1]  1  2  3  4  5  6  7  8  9 10

Error in .Call("someCPPcode", r) : 
  "someCPPcode" not resolved from current namespace (rcppcuda)
&gt; 
</code></pre>

<p>The error goes away in the <code>withoutCUDA</code> branch in the commit entitled "adding branch withoutCUDA".</p>

<pre><code>&gt; library(rcppcuda)
&gt; hello()
An object of class "MyClass"
Slot "x":
 [1]  1  2  3  4  5  6  7  8  9 10

Slot "y":
 [1]  1  2  3  4  5  6  7  8  9 10

[1] "Object changed."
An object of class "MyClass"
Slot "x":
 [1] 500   2   3   4   5   6   7   8   9  10

Slot "y":
 [1]    1 1000    3    4    5    6    7    8    9   10

&gt; 
</code></pre>

<p>The only differences between the "compiling cpp and cu separately" commit on <code>master</code> and the "adding branch withoutCUDA" commit on <code>withoutCUDA</code> are</p>

<ul>
<li>The Makefile and someCUDAcode.cu are gone from <code>withoutCUDA</code>.</li>
<li>In <code>withoutCUDA</code>, all references to <code>someCUDAcode()</code> are gone from someCPPcode.cpp.</li>
</ul>

<p>Also, it would still be convenient be able to use CUDA and Rcpp in the same <code>*.cu</code> file. I would really like to know how to fix the "fixed namespace" commit on the master branch.</p>

        </details>
      </div>
    </div>

  </div>

</article> <article class="qa" id="qa-19686892">

  <div class="question">

    <div class="stats">
      <div class="votes">
        <span class="score">14</span>
        <div class="viewcount">votes</div>
      </div>
      <div class="views">
        <span class="score">556</span>
        <div class="viewcount">views</div>
      </div>
    </div>

    <div class="content">
      <div class="title">
        <h3>passing unevaluated expressions to C/C++</h3>
        <a href="https://stackoverflow.com/questions/19686892/passing-unevaluated-expressions-to-c-c" target="_blank">[see original]</a>
      </div>
      <div class="tags"><span>c</span><span>r</span><span>rcpp</span></div>
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/817778/eddi" target="_blank"><img src="https://www.gravatar.com/avatar/20cc8f574b01913048718f0abd4bf861?s=256&d=identicon&r=PG" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/817778/eddi" target="_blank">eddi</a>
        asked Oct 30 '13 at 15:24
      </div>
      <div class="body">
        <details>
          <summary>Click to expand question</summary>
          <p>I'd like to pass a variable number of arguments from a function to C/C++, but would like to leave the arguments unevaluated and at the same time don't want to do any computations in R (aside from calling the C/C++ function), i.e. I don't want to call <code>substitute</code> in my R function. One option for this that I thought I could use is <code>.External</code> and doing smth like this:</p>

<pre><code>R_fn = function(...) .External("cpp_fn", ...)

...
# and in C code:
SEXP cpp_fn (SEXP arglist) {
}
</code></pre>

<p>However <code>.External</code> is evaluating arguments in <code>...</code>, so if I try something like</p>

<pre><code>rm(x, y) # just making sure these don't exist

R_fn(x*y)
</code></pre>

<p>I get an error because R is trying to evaluate <code>x*y</code> <em>before</em> sending it to the function.</p>

<p>To contrast, the following works in R:</p>

<pre><code>f = function(...) g(...)
g = function(x, ...) print(substitute(x))

f(x*y*z)
# x * y * z
</code></pre>

<p>What other options do I have? Clearly it's possible to do as R itself does it for a number of functions, e.g. <code>substitute</code> itself, but I don't understand how to do it. I added the <code>rcpp</code> tag because my eventual usage of this is going to be in <code>Rcpp</code>.</p>

        </details>
      </div>
    </div>

  </div>

  <div class="answer">

    <div class="stats">
      <div class="votes answer-accepted-TRUE">
        <span class="score">5</span>
        <div class="viewcount">votes</div>
      </div>
    </div>

    <div class="content">
      <div class="author">
        <span class="gravatar">
          <a href="https://stackoverflow.com/users/817778/eddi" target="_blank"><img src="https://www.gravatar.com/avatar/20cc8f574b01913048718f0abd4bf861?s=256&d=identicon&r=PG" alt="" width="32" height="32"></a>
        </span>
        <a href="https://stackoverflow.com/users/817778/eddi" target="_blank">eddi</a>
        replied Oct 31 '13 at 16:16
      </div>
      <div class="body">
        <details>
          <summary>Click to expand answer</summary>
          <p>I'd like to pass a variable number of arguments from a function to C/C++, but would like to leave the arguments unevaluated and at the same time don't want to do any computations in R (aside from calling the C/C++ function), i.e. I don't want to call <code>substitute</code> in my R function. One option for this that I thought I could use is <code>.External</code> and doing smth like this:</p>

<pre><code>R_fn = function(...) .External("cpp_fn", ...)

...
# and in C code:
SEXP cpp_fn (SEXP arglist) {
}
</code></pre>

<p>However <code>.External</code> is evaluating arguments in <code>...</code>, so if I try something like</p>

<pre><code>rm(x, y) # just making sure these don't exist

R_fn(x*y)
</code></pre>

<p>I get an error because R is trying to evaluate <code>x*y</code> <em>before</em> sending it to the function.</p>

<p>To contrast, the following works in R:</p>

<pre><code>f = function(...) g(...)
g = function(x, ...) print(substitute(x))

f(x*y*z)
# x * y * z
</code></pre>

<p>What other options do I have? Clearly it's possible to do as R itself does it for a number of functions, e.g. <code>substitute</code> itself, but I don't understand how to do it. I added the <code>rcpp</code> tag because my eventual usage of this is going to be in <code>Rcpp</code>.</p>

        </details>
      </div>
    </div>

  </div>

</article>
    </section>
  </main>
</body>
</html>
